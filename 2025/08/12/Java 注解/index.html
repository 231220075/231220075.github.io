<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Java 注解 | Summer Flower</title><meta name="author" content="forever"><meta name="copyright" content="forever"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="yys-project中延伸学习Java注解，上传一下">
<meta property="og:type" content="article">
<meta property="og:title" content="Java 注解">
<meta property="og:url" content="http://summer-flower.com/2025/08/12/Java%20%E6%B3%A8%E8%A7%A3/index.html">
<meta property="og:site_name" content="Summer Flower">
<meta property="og:description" content="yys-project中延伸学习Java注解，上传一下">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://summer-flower.com/photos/avatar.jpg">
<meta property="article:published_time" content="2025-08-12T08:18:13.000Z">
<meta property="article:modified_time" content="2025-08-12T08:18:13.000Z">
<meta property="article:author" content="forever">
<meta property="article:tag" content="JAVA">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://summer-flower.com/photos/avatar.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Java 注解",
  "url": "http://summer-flower.com/2025/08/12/Java%20%E6%B3%A8%E8%A7%A3/",
  "image": "http://summer-flower.com/photos/avatar.jpg",
  "datePublished": "2025-08-12T08:18:13.000Z",
  "dateModified": "2025-08-12T08:18:13.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "forever",
      "url": "http://summer-flower.com"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="http://summer-flower.com/2025/08/12/Java%20%E6%B3%A8%E8%A7%A3/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//www.clarity.ms"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="manifest" href="/manifest.json"/><link rel="apple-touch-icon" sizes="180x180" href="/img/favicon.ico"/><link rel="icon" type="image/png" sizes="32x32" href="/img/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/img/favicon.ico"/><link rel="mask-icon" href="/img/favicon.ico" color="#5bbad5"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          const hour = new Date().getHours()
          const isNight = hour <= 6 || hour >= 18
          if (theme === undefined) isNight ? activateDarkMode() : activateLightMode()
          else theme === 'light' ? activateLightMode() : activateDarkMode()
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>(function(c,l,a,r,i,t,y){
    c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
    t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
    y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
})(window, document, "clarity", "script", "su3jybron2");
</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"No results found for: ${query}","hits_stats":"${hits} articles found"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"You have switched to Traditional Chinese","cht_to_chs":"You have switched to Simplified Chinese","day_to_night":"You have switched to Dark Mode","night_to_day":"You have switched to Light Mode","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-right"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Java 注解',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><script src="https://fastly.jsdelivr.net/gh/stevenjoezhang/live2d-widget@latest/autoload.js"></script><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="Summer Flower" type="application/atom+xml">
</head><body><div id="web_bg" style="background-image: url(/url(/source/photos/arknight.jpg));"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/photos/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">11</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">15</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">4</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li><li><a class="site-page child" href="/photos-gallery/"><i class="fa-fw fas fa-camera"></i><span> Photos</span></a></li><li><a class="site-page child" href="/games/"><i class="fa-fw fas fa-gamepad"></i><span> Games</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fas fa-link"></i><span> Links</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> About</span></a></div><div class="menus_item"><a class="site-page" href="/sitemap/"><i class="fa-fw fas fa-sitemap"></i><span> Sitemap</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-envelope-open"></i><span> Comments</span></a></div><div class="menus_item"><a class="site-page" href="/browser/"><i class="fa-fw fas fa-globe"></i><span> Browser</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Summer Flower</span></a><a class="nav-page-title" href="/"><span class="site-name">Java 注解</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  Back to Home</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li><li><a class="site-page child" href="/photos-gallery/"><i class="fa-fw fas fa-camera"></i><span> Photos</span></a></li><li><a class="site-page child" href="/games/"><i class="fa-fw fas fa-gamepad"></i><span> Games</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fas fa-link"></i><span> Links</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> About</span></a></div><div class="menus_item"><a class="site-page" href="/sitemap/"><i class="fa-fw fas fa-sitemap"></i><span> Sitemap</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-envelope-open"></i><span> Comments</span></a></div><div class="menus_item"><a class="site-page" href="/browser/"><i class="fa-fw fas fa-globe"></i><span> Browser</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Java 注解</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2025-08-12T08:18:13.000Z" title="Created 2025-08-12 16:18:13">2025-08-12</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-08-12T08:18:13.000Z" title="Updated 2025-08-12 16:18:13">2025-08-12</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%8A%80%E6%9C%AF%E5%AD%A6%E4%B9%A0/">技术学习</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word Count:</span><span class="word-count">14.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading Time:</span><span>68mins</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:365,&quot;messagePrev&quot;:&quot;It has been&quot;,&quot;messageNext&quot;:&quot;days since the last update, the content of the article may be outdated.&quot;,&quot;postUpdate&quot;:&quot;2025-08-12 16:18:13&quot;}" hidden></div><h1 id="📝-Java-注解完全指南"><a href="#📝-Java-注解完全指南" class="headerlink" title="📝 Java 注解完全指南"></a>📝 Java 注解完全指南</h1><blockquote>
<p>yys-project中延伸学习Java注解，上传一下</p>
</blockquote>
<h2 id="1-什么是Java注解？"><a href="#1-什么是Java注解？" class="headerlink" title="1. 什么是Java注解？"></a>1. 什么是Java注解？</h2><p>Java注解（Annotation）是Java 5引入的一种元数据机制，它为代码提供了一种描述性的信息，而不直接影响代码的执行逻辑。可以把注解理解为”给代码贴标签”，这些标签可以被编译器、开发工具或运行时环境读取和处理。</p>
<h3 id="注解的本质"><a href="#注解的本质" class="headerlink" title="注解的本质"></a>注解的本质</h3><ul>
<li>注解本质上是一种特殊的接口</li>
<li>继承自<code>java.lang.annotation.Annotation</code>接口</li>
<li>在编译后会生成相应的字节码信息</li>
</ul>
<h2 id="2-Java注解-vs-C-的对比"><a href="#2-Java注解-vs-C-的对比" class="headerlink" title="2. Java注解 vs C++的对比"></a>2. Java注解 vs C++的对比</h2><table>
<thead>
<tr>
<th>特性</th>
<th>Java注解</th>
<th>C++宏&#x2F;预处理指令</th>
<th>C++属性(C++11+)</th>
</tr>
</thead>
<tbody><tr>
<td><strong>语法</strong></td>
<td><code>@注解名</code></td>
<td><code>#define</code>, <code>#pragma</code></td>
<td><code>[[属性名]]</code></td>
</tr>
<tr>
<td><strong>处理时机</strong></td>
<td>编译时&#x2F;运行时</td>
<td>预处理时</td>
<td>编译时</td>
</tr>
<tr>
<td><strong>类型安全</strong></td>
<td>强类型</td>
<td>弱类型</td>
<td>强类型</td>
</tr>
<tr>
<td><strong>反射支持</strong></td>
<td>完全支持</td>
<td>不支持</td>
<td>有限支持</td>
</tr>
<tr>
<td><strong>功能范围</strong></td>
<td>元数据、验证、代码生成</td>
<td>文本替换、条件编译</td>
<td>优化提示、属性标记</td>
</tr>
</tbody></table>
<h3 id="举例对比："><a href="#举例对比：" class="headerlink" title="举例对比："></a>举例对比：</h3><p><strong>Java注解：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;example&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>C++属性：</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[[<span class="keyword">override</span>]]</span><br><span class="line"><span class="function"><span class="keyword">virtual</span> std::string <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;example&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>C++宏：</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> OVERRIDE virtual</span></span><br><span class="line"><span class="function">OVERRIDE std::string <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;example&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-注解的工作原理"><a href="#3-注解的工作原理" class="headerlink" title="3. 注解的工作原理"></a>3. 注解的工作原理</h2><h3 id="3-1-编译时处理"><a href="#3-1-编译时处理" class="headerlink" title="3.1 编译时处理"></a>3.1 编译时处理</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 源代码</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 编译后的字节码中会包含注解信息</span></span><br><span class="line"><span class="comment">// 可以通过反射API在运行时访问</span></span><br></pre></td></tr></table></figure>

<h3 id="3-2-三个处理阶段"><a href="#3-2-三个处理阶段" class="headerlink" title="3.2 三个处理阶段"></a>3.2 三个处理阶段</h3><ol>
<li><strong>源码阶段</strong>：注解存在于.java文件中</li>
<li><strong>编译阶段</strong>：注解被编译器处理，可能生成额外代码</li>
<li><strong>运行阶段</strong>：通过反射API读取注解信息</li>
</ol>
<h3 id="3-3-注解处理器（Annotation-Processor）"><a href="#3-3-注解处理器（Annotation-Processor）" class="headerlink" title="3.3 注解处理器（Annotation Processor）"></a>3.3 注解处理器（Annotation Processor）</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 自定义注解处理器示例</span></span><br><span class="line"><span class="meta">@SupportedAnnotationTypes(&quot;com.example.MyAnnotation&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyProcessor</span> <span class="keyword">extends</span> <span class="title class_">AbstractProcessor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">process</span><span class="params">(Set&lt;? extends TypeElement&gt; annotations, </span></span><br><span class="line"><span class="params">                          RoundEnvironment roundEnv)</span> &#123;</span><br><span class="line">        <span class="comment">// 在编译时处理注解</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-注解的分类"><a href="#4-注解的分类" class="headerlink" title="4. 注解的分类"></a>4. 注解的分类</h2><h3 id="4-1-按生命周期分类"><a href="#4-1-按生命周期分类" class="headerlink" title="4.1 按生命周期分类"></a>4.1 按生命周期分类</h3><h4 id="SOURCE（源码级）"><a href="#SOURCE（源码级）" class="headerlink" title="SOURCE（源码级）"></a>SOURCE（源码级）</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Retention(RetentionPolicy.SOURCE)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SourceAnnotation &#123;</span><br><span class="line">    String <span class="title function_">value</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>只在源码中存在，编译后丢弃</li>
<li>主要用于编译时检查</li>
<li>例如：<code>@Override</code>, <code>@SuppressWarnings</code></li>
</ul>
<h4 id="CLASS（字节码级）"><a href="#CLASS（字节码级）" class="headerlink" title="CLASS（字节码级）"></a>CLASS（字节码级）</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Retention(RetentionPolicy.CLASS)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> ClassAnnotation &#123;</span><br><span class="line">    String <span class="title function_">value</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>在字节码中保留，但运行时不可访问</li>
<li>默认的保留策略</li>
<li>用于编译时或字节码处理工具</li>
</ul>
<h4 id="RUNTIME（运行时级）"><a href="#RUNTIME（运行时级）" class="headerlink" title="RUNTIME（运行时级）"></a>RUNTIME（运行时级）</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> RuntimeAnnotation &#123;</span><br><span class="line">    String <span class="title function_">value</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>运行时可通过反射访问</li>
<li>最常用的类型</li>
<li>用于框架和库的运行时处理</li>
</ul>
<h3 id="4-2-按作用目标分类"><a href="#4-2-按作用目标分类" class="headerlink" title="4.2 按作用目标分类"></a>4.2 按作用目标分类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE, ElementType.METHOD&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MyAnnotation &#123;</span><br><span class="line">    <span class="comment">// 可以用在类和方法上</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>常见的ElementType：</p>
<ul>
<li><code>TYPE</code>：类、接口、枚举</li>
<li><code>METHOD</code>：方法</li>
<li><code>FIELD</code>：字段</li>
<li><code>PARAMETER</code>：参数</li>
<li><code>CONSTRUCTOR</code>：构造器</li>
<li><code>PACKAGE</code>：包</li>
</ul>
<h2 id="5-常见内置注解详解"><a href="#5-常见内置注解详解" class="headerlink" title="5. 常见内置注解详解"></a>5. 常见内置注解详解</h2><h3 id="5-1-基础注解"><a href="#5-1-基础注解" class="headerlink" title="5.1 基础注解"></a>5.1 基础注解</h3><h4 id="Override"><a href="#Override" class="headerlink" title="@Override"></a>@Override</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Child</span> <span class="keyword">extends</span> <span class="title class_">Parent</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span>  <span class="comment">// 确保正确重写父类方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;子类实现&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>功能</strong>：</p>
<ul>
<li>编译时检查是否正确重写了父类方法</li>
<li>提高代码可读性</li>
<li>防止方法签名错误</li>
</ul>
<h4 id="Deprecated"><a href="#Deprecated" class="headerlink" title="@Deprecated"></a>@Deprecated</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OldAPI</span> &#123;</span><br><span class="line">    <span class="meta">@Deprecated(since = &quot;1.5&quot;, forRemoval = true)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">oldMethod</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 已废弃的方法</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">newMethod</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 推荐使用的新方法</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>功能</strong>：</p>
<ul>
<li>标记已废弃的API</li>
<li>编译时产生警告</li>
<li>可以指定废弃版本和是否将被移除</li>
</ul>
<h4 id="SuppressWarnings"><a href="#SuppressWarnings" class="headerlink" title="@SuppressWarnings"></a>@SuppressWarnings</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Example</span> &#123;</span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">List</span> <span class="variable">list</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>();  <span class="comment">// 原始类型警告被抑制</span></span><br><span class="line">        list.add(<span class="string">&quot;item&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@SuppressWarnings(&#123;&quot;unused&quot;, &quot;deprecation&quot;&#125;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">anotherMethod</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 抑制多种警告</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>常用警告类型</strong>：</p>
<ul>
<li><code>unchecked</code>：未检查转换</li>
<li><code>unused</code>：未使用的变量</li>
<li><code>deprecation</code>：使用已废弃的API</li>
<li><code>rawtypes</code>：使用原始类型</li>
</ul>
<h4 id="SafeVarargs"><a href="#SafeVarargs" class="headerlink" title="@SafeVarargs"></a>@SafeVarargs</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VarargsExample</span> &#123;</span><br><span class="line">    <span class="meta">@SafeVarargs</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="keyword">void</span> <span class="title function_">printAll</span><span class="params">(T... items)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (T item : items) &#123;</span><br><span class="line">            System.out.println(item);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-2-函数式接口注解"><a href="#5-2-函数式接口注解" class="headerlink" title="5.2 函数式接口注解"></a>5.2 函数式接口注解</h3><h4 id="FunctionalInterface-详细解释"><a href="#FunctionalInterface-详细解释" class="headerlink" title="@FunctionalInterface 详细解释"></a>@FunctionalInterface 详细解释</h4><p><code>@FunctionalInterface</code>注解用来标记一个接口是<strong>函数式接口</strong>，这是Java 8引入Lambda表达式后的重要概念。</p>
<h5 id="什么是函数式接口？"><a href="#什么是函数式接口？" class="headerlink" title="什么是函数式接口？"></a>什么是函数式接口？</h5><p>函数式接口是<strong>只有一个抽象方法</strong>的接口，它可以被Lambda表达式实现。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Calculator</span> &#123;</span><br><span class="line">    <span class="comment">// 只能有一个抽象方法（核心要求）</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">calculate</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 可以有默认方法（不算抽象方法）</span></span><br><span class="line">    <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">log</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;计算完成&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 可以有静态方法（不算抽象方法）</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">info</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;这是一个计算器接口&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Lambda表达式实现"><a href="#Lambda表达式实现" class="headerlink" title="Lambda表达式实现"></a>Lambda表达式实现</h5><p>传统方式 vs Lambda方式的对比：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ❌ 传统方式：使用匿名内部类</span></span><br><span class="line"><span class="type">Calculator</span> <span class="variable">add</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Calculator</span>() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">calculate</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ Lambda方式：简洁明了</span></span><br><span class="line"><span class="type">Calculator</span> <span class="variable">add</span> <span class="operator">=</span> (a, b) -&gt; a + b;</span><br><span class="line"><span class="type">Calculator</span> <span class="variable">multiply</span> <span class="operator">=</span> (a, b) -&gt; a * b;</span><br><span class="line"><span class="type">Calculator</span> <span class="variable">subtract</span> <span class="operator">=</span> (a, b) -&gt; a - b;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="type">int</span> <span class="variable">result1</span> <span class="operator">=</span> add.calculate(<span class="number">5</span>, <span class="number">3</span>);        <span class="comment">// 结果：8</span></span><br><span class="line"><span class="type">int</span> <span class="variable">result2</span> <span class="operator">=</span> multiply.calculate(<span class="number">4</span>, <span class="number">6</span>);   <span class="comment">// 结果：24</span></span><br><span class="line"><span class="type">int</span> <span class="variable">result3</span> <span class="operator">=</span> subtract.calculate(<span class="number">10</span>, <span class="number">4</span>);  <span class="comment">// 结果：6</span></span><br></pre></td></tr></table></figure>

<h5 id="Lambda表达式语法详解"><a href="#Lambda表达式语法详解" class="headerlink" title="Lambda表达式语法详解"></a>Lambda表达式语法详解</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 完整语法：(参数列表) -&gt; &#123; 方法体 &#125;</span></span><br><span class="line"><span class="type">Calculator</span> <span class="variable">complex</span> <span class="operator">=</span> (<span class="type">int</span> a, <span class="type">int</span> b) -&gt; &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;正在计算: &quot;</span> + a + <span class="string">&quot; + &quot;</span> + b);</span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> a + b;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 简化语法：参数类型可以省略（类型推断）</span></span><br><span class="line"><span class="type">Calculator</span> <span class="variable">simple</span> <span class="operator">=</span> (a, b) -&gt; a + b;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 单参数可以省略括号</span></span><br><span class="line">Function&lt;Integer, Integer&gt; square = x -&gt; x * x;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 无参数必须保留空括号</span></span><br><span class="line">Supplier&lt;String&gt; greeting = () -&gt; <span class="string">&quot;Hello World&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 单条语句可以省略大括号和return</span></span><br><span class="line"><span class="type">Calculator</span> <span class="variable">add</span> <span class="operator">=</span> (a, b) -&gt; a + b;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 多条语句必须使用大括号和return</span></span><br><span class="line"><span class="type">Calculator</span> <span class="variable">verbose</span> <span class="operator">=</span> (a, b) -&gt; &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;开始计算&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h5 id="常见的函数式接口"><a href="#常见的函数式接口" class="headerlink" title="常见的函数式接口"></a>常见的函数式接口</h5><p>Java提供了许多内置的函数式接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. Supplier&lt;T&gt; - 供应商：无参数，返回T类型</span></span><br><span class="line">Supplier&lt;String&gt; stringSupplier = () -&gt; <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">Supplier&lt;Integer&gt; randomNum = () -&gt; <span class="keyword">new</span> <span class="title class_">Random</span>().nextInt(<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. Consumer&lt;T&gt; - 消费者：接受T类型参数，无返回值</span></span><br><span class="line">Consumer&lt;String&gt; printer = str -&gt; System.out.println(str);</span><br><span class="line">Consumer&lt;Integer&gt; logger = num -&gt; System.out.println(<span class="string">&quot;数字：&quot;</span> + num);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. Function&lt;T, R&gt; - 函数：接受T类型，返回R类型</span></span><br><span class="line">Function&lt;String, Integer&gt; stringLength = str -&gt; str.length();</span><br><span class="line">Function&lt;Integer, String&gt; intToString = num -&gt; <span class="string">&quot;数字：&quot;</span> + num;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. Predicate&lt;T&gt; - 断言：接受T类型，返回boolean</span></span><br><span class="line">Predicate&lt;String&gt; isEmpty = str -&gt; str.isEmpty();</span><br><span class="line">Predicate&lt;Integer&gt; isEven = num -&gt; num % <span class="number">2</span> == <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5. BiFunction&lt;T, U, R&gt; - 双参数函数：接受T和U，返回R</span></span><br><span class="line">BiFunction&lt;Integer, Integer, Integer&gt; add = (a, b) -&gt; a + b;</span><br><span class="line">BiFunction&lt;String, String, String&gt; concat = (s1, s2) -&gt; s1 + s2;</span><br></pre></td></tr></table></figure>

<h5 id="实际应用示例"><a href="#实际应用示例" class="headerlink" title="实际应用示例"></a>实际应用示例</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CalculatorDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 定义不同的计算方式</span></span><br><span class="line">        <span class="type">Calculator</span> <span class="variable">add</span> <span class="operator">=</span> (a, b) -&gt; a + b;</span><br><span class="line">        <span class="type">Calculator</span> <span class="variable">multiply</span> <span class="operator">=</span> (a, b) -&gt; a * b;</span><br><span class="line">        <span class="type">Calculator</span> <span class="variable">max</span> <span class="operator">=</span> (a, b) -&gt; Math.max(a, b);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 使用计算器</span></span><br><span class="line">        performCalculation(<span class="number">10</span>, <span class="number">5</span>, add);      <span class="comment">// 输出：结果：15</span></span><br><span class="line">        performCalculation(<span class="number">10</span>, <span class="number">5</span>, multiply); <span class="comment">// 输出：结果：50</span></span><br><span class="line">        performCalculation(<span class="number">10</span>, <span class="number">5</span>, max);      <span class="comment">// 输出：结果：10</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 集合操作中使用Lambda</span></span><br><span class="line">        List&lt;Integer&gt; numbers = Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 过滤偶数</span></span><br><span class="line">        List&lt;Integer&gt; evenNumbers = numbers.stream()</span><br><span class="line">            .filter(n -&gt; n % <span class="number">2</span> == <span class="number">0</span>)</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 平方运算</span></span><br><span class="line">        List&lt;Integer&gt; squares = numbers.stream()</span><br><span class="line">            .map(n -&gt; n * n)</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 求和</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> numbers.stream()</span><br><span class="line">            .reduce(<span class="number">0</span>, (a, b) -&gt; a + b);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 高阶函数：接受函数作为参数</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">performCalculation</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b, Calculator calc)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> calc.calculate(a, b);</span><br><span class="line">        System.out.println(<span class="string">&quot;结果：&quot;</span> + result);</span><br><span class="line">        calc.log(); <span class="comment">// 调用默认方法</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="FunctionalInterface注解的作用"><a href="#FunctionalInterface注解的作用" class="headerlink" title="@FunctionalInterface注解的作用"></a>@FunctionalInterface注解的作用</h5><ol>
<li><strong>编译时检查</strong>：确保接口只有一个抽象方法</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">InvalidInterface</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">method1</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">method2</span><span class="params">()</span>; <span class="comment">// 编译错误！函数式接口只能有一个抽象方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>文档说明</strong>：明确表示这是一个函数式接口</li>
<li><strong>IDE支持</strong>：开发工具可以提供更好的Lambda支持</li>
</ol>
<h5 id="与传统接口的区别"><a href="#与传统接口的区别" class="headerlink" title="与传统接口的区别"></a>与传统接口的区别</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 传统接口 - 可能有多个抽象方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">TraditionalInterface</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">method1</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">method2</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">method3</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数式接口 - 只有一个抽象方法</span></span><br><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">FunctionalInterface</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">singleMethod</span><span class="params">()</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 可以有默认方法和静态方法</span></span><br><span class="line">    <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">defaultMethod</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">staticMethod</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="方法引用（Method-Reference）"><a href="#方法引用（Method-Reference）" class="headerlink" title="方法引用（Method Reference）"></a>方法引用（Method Reference）</h5><p>Lambda表达式的进一步简化：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Lambda表达式</span></span><br><span class="line">Function&lt;String, Integer&gt; lengthLambda = str -&gt; str.length();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法引用（更简洁）</span></span><br><span class="line">Function&lt;String, Integer&gt; lengthMethodRef = String::length;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 其他方法引用示例</span></span><br><span class="line">Consumer&lt;String&gt; printLambda = str -&gt; System.out.println(str);</span><br><span class="line">Consumer&lt;String&gt; printMethodRef = System.out::println;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构造器引用</span></span><br><span class="line">Supplier&lt;ArrayList&lt;String&gt;&gt; listSupplier = ArrayList::<span class="keyword">new</span>;</span><br></pre></td></tr></table></figure>

<p><strong>总结</strong>：<code>@FunctionalInterface</code>让Java支持函数式编程，使代码更简洁、更具表达力。Lambda表达式本质上是匿名函数的简写，让我们可以将行为作为参数传递，这是现代Java编程的重要特性！</p>
<h2 id="6-框架中的常用注解"><a href="#6-框架中的常用注解" class="headerlink" title="6. 框架中的常用注解"></a>6. 框架中的常用注解</h2><h3 id="什么是Spring框架？"><a href="#什么是Spring框架？" class="headerlink" title="什么是Spring框架？"></a>什么是Spring框架？</h3><p><strong>Spring</strong>是Java企业级开发中最流行的应用框架，它提供了：</p>
<ul>
<li><strong>依赖注入（DI）</strong>：自动管理对象间的依赖关系</li>
<li><strong>面向切面编程（AOP）</strong>：统一处理横切关注点（如日志、事务）</li>
<li><strong>事务管理</strong>：简化数据库事务处理</li>
<li><strong>Web开发支持</strong>：MVC架构支持</li>
</ul>
<p><strong>Spring Boot</strong>是Spring的进化版，它：</p>
<ul>
<li><strong>自动配置</strong>：根据依赖自动配置Spring应用</li>
<li><strong>内嵌服务器</strong>：无需外部Tomcat，直接运行</li>
<li><strong>简化配置</strong>：减少XML配置，基于注解开发</li>
<li><strong>微服务友好</strong>：易于构建独立的微服务应用</li>
</ul>
<h3 id="6-1-Spring核心注解详解"><a href="#6-1-Spring核心注解详解" class="headerlink" title="6.1 Spring核心注解详解"></a>6.1 Spring核心注解详解</h3><h4 id="组件注解系列"><a href="#组件注解系列" class="headerlink" title="组件注解系列"></a>组件注解系列</h4><h5 id="Component-通用组件注解"><a href="#Component-通用组件注解" class="headerlink" title="@Component - 通用组件注解"></a>@Component - 通用组件注解</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Component</span>: Spring的基础组件注解</span></span><br><span class="line"><span class="comment"> * 功能：告诉Spring这是一个需要管理的Bean（对象）</span></span><br><span class="line"><span class="comment"> * 作用：Spring会自动创建这个类的实例，并放入容器中管理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmailService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendEmail</span><span class="params">(String to, String message)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;发送邮件到: &quot;</span> + to);</span><br><span class="line">        System.out.println(<span class="string">&quot;内容: &quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 可以指定Bean的名称</span></span><br><span class="line"><span class="meta">@Component(&quot;customEmailService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomEmailService</span> &#123;</span><br><span class="line">    <span class="comment">// Spring容器中这个Bean的名称是&quot;customEmailService&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Service-业务逻辑层注解"><a href="#Service-业务逻辑层注解" class="headerlink" title="@Service - 业务逻辑层注解"></a>@Service - 业务逻辑层注解</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Service</span>: 标记业务逻辑层组件</span></span><br><span class="line"><span class="comment"> * 功能：本质上等同于<span class="doctag">@Component</span>，但语义更明确</span></span><br><span class="line"><span class="comment"> * 用途：处理业务逻辑、调用数据访问层、实现业务规则</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserRepository userRepository;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 业务方法：创建用户</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">createUser</span><span class="params">(String username, String email)</span> &#123;</span><br><span class="line">        <span class="comment">// 业务逻辑：验证用户名是否重复</span></span><br><span class="line">        <span class="keyword">if</span> (userRepository.existsByUsername(username)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;用户名已存在&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 创建用户对象</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setUsername(username);</span><br><span class="line">        user.setEmail(email);</span><br><span class="line">        user.setCreatedAt(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 保存到数据库</span></span><br><span class="line">        <span class="keyword">return</span> userRepository.save(user);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 业务方法：用户登录验证</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">authenticate</span><span class="params">(String username, String password)</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userRepository.findByUsername(username);</span><br><span class="line">        <span class="keyword">return</span> user != <span class="literal">null</span> &amp;&amp; user.getPassword().equals(password);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Repository-数据访问层注解"><a href="#Repository-数据访问层注解" class="headerlink" title="@Repository - 数据访问层注解"></a>@Repository - 数据访问层注解</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Repository</span>: 标记数据访问层组件</span></span><br><span class="line"><span class="comment"> * 功能：</span></span><br><span class="line"><span class="comment"> * 1. 等同于<span class="doctag">@Component</span>，但语义更明确</span></span><br><span class="line"><span class="comment"> * 2. 自动将数据访问异常转换为Spring的DataAccessException</span></span><br><span class="line"><span class="comment"> * 用途：处理数据库操作、文件操作等数据访问逻辑</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserRepository</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 数据访问方法：根据ID查找用户</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">findById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;SELECT * FROM users WHERE id = ?&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> jdbcTemplate.queryForObject(sql, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;id&#125;, </span><br><span class="line">            (rs, rowNum) -&gt; &#123;</span><br><span class="line">                <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">                user.setId(rs.getLong(<span class="string">&quot;id&quot;</span>));</span><br><span class="line">                user.setUsername(rs.getString(<span class="string">&quot;username&quot;</span>));</span><br><span class="line">                user.setEmail(rs.getString(<span class="string">&quot;email&quot;</span>));</span><br><span class="line">                <span class="keyword">return</span> user;</span><br><span class="line">            &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 数据访问方法：保存用户</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">save</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (user.getId() == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// 新建用户</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;INSERT INTO users (username, email, created_at) VALUES (?, ?, ?)&quot;</span>;</span><br><span class="line">            <span class="type">KeyHolder</span> <span class="variable">keyHolder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GeneratedKeyHolder</span>();</span><br><span class="line">            jdbcTemplate.update(connection -&gt; &#123;</span><br><span class="line">                <span class="type">PreparedStatement</span> <span class="variable">ps</span> <span class="operator">=</span> connection.prepareStatement(sql, Statement.RETURN_GENERATED_KEYS);</span><br><span class="line">                ps.setString(<span class="number">1</span>, user.getUsername());</span><br><span class="line">                ps.setString(<span class="number">2</span>, user.getEmail());</span><br><span class="line">                ps.setTimestamp(<span class="number">3</span>, <span class="keyword">new</span> <span class="title class_">Timestamp</span>(user.getCreatedAt().getTime()));</span><br><span class="line">                <span class="keyword">return</span> ps;</span><br><span class="line">            &#125;, keyHolder);</span><br><span class="line">            user.setId(keyHolder.getKey().longValue());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 更新用户</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;UPDATE users SET username = ?, email = ? WHERE id = ?&quot;</span>;</span><br><span class="line">            jdbcTemplate.update(sql, user.getUsername(), user.getEmail(), user.getId());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">existsByUsername</span><span class="params">(String username)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;SELECT COUNT(*) FROM users WHERE username = ?&quot;</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> jdbcTemplate.queryForObject(sql, Integer.class, username);</span><br><span class="line">        <span class="keyword">return</span> count &gt; <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Controller-Web控制器注解"><a href="#Controller-Web控制器注解" class="headerlink" title="@Controller - Web控制器注解"></a>@Controller - Web控制器注解</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Controller</span>: 标记Web控制器组件</span></span><br><span class="line"><span class="comment"> * 功能：处理HTTP请求，返回视图（如JSP、Thymeleaf模板）</span></span><br><span class="line"><span class="comment"> * 用途：传统的MVC架构中的Controller层</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/web&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 处理GET请求，返回用户列表页面</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/users&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">listUsers</span><span class="params">(Model model)</span> &#123;</span><br><span class="line">        List&lt;User&gt; users = userService.getAllUsers();</span><br><span class="line">        model.addAttribute(<span class="string">&quot;users&quot;</span>, users);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;user-list&quot;</span>; <span class="comment">// 返回视图名称，对应user-list.html模板</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 处理GET请求，显示用户详情页面</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/users/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">userDetail</span><span class="params">(<span class="meta">@PathVariable</span> Long id, Model model)</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.findById(id);</span><br><span class="line">        model.addAttribute(<span class="string">&quot;user&quot;</span>, user);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;user-detail&quot;</span>; <span class="comment">// 返回user-detail.html模板</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 处理POST请求，创建用户后重定向</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/users&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">createUser</span><span class="params">(<span class="meta">@ModelAttribute</span> User user)</span> &#123;</span><br><span class="line">        userService.createUser(user.getUsername(), user.getEmail());</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;redirect:/web/users&quot;</span>; <span class="comment">// 重定向到用户列表页面</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="依赖注入注解"><a href="#依赖注入注解" class="headerlink" title="依赖注入注解"></a>依赖注入注解</h4><h5 id="Autowired-自动装配注解"><a href="#Autowired-自动装配注解" class="headerlink" title="@Autowired - 自动装配注解"></a>@Autowired - 自动装配注解</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Autowired</span>: 自动依赖注入注解</span></span><br><span class="line"><span class="comment"> * 功能：Spring自动查找匹配的Bean并注入</span></span><br><span class="line"><span class="comment"> * 原理：按类型（Type）匹配，如果有多个同类型Bean则按名称匹配</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 1. 字段注入（最常用，但不推荐用于测试）</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PaymentService paymentService;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 构造器注入（推荐方式，便于测试和确保依赖不为null）</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> EmailService emailService;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> InventoryService inventoryService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">OrderService</span><span class="params">(EmailService emailService, InventoryService inventoryService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.emailService = emailService;</span><br><span class="line">        <span class="built_in">this</span>.inventoryService = inventoryService;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. Setter注入（可选依赖）</span></span><br><span class="line">    <span class="keyword">private</span> NotificationService notificationService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired(required = false)</span> <span class="comment">// required=false表示这个依赖是可选的</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setNotificationService</span><span class="params">(NotificationService notificationService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.notificationService = notificationService;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Order <span class="title function_">createOrder</span><span class="params">(Long userId, List&lt;OrderItem&gt; items)</span> &#123;</span><br><span class="line">        <span class="comment">// 使用注入的依赖</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.findById(userId);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 检查库存</span></span><br><span class="line">        <span class="keyword">for</span> (OrderItem item : items) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!inventoryService.isAvailable(item.getProductId(), item.getQuantity())) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;库存不足&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 创建订单</span></span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Order</span>();</span><br><span class="line">        order.setUser(user);</span><br><span class="line">        order.setItems(items);</span><br><span class="line">        order.setStatus(<span class="string">&quot;CREATED&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 处理支付</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">paymentSuccess</span> <span class="operator">=</span> paymentService.processPayment(order.getTotalAmount());</span><br><span class="line">        <span class="keyword">if</span> (paymentSuccess) &#123;</span><br><span class="line">            order.setStatus(<span class="string">&quot;PAID&quot;</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 发送邮件通知</span></span><br><span class="line">            emailService.sendEmail(user.getEmail(), <span class="string">&quot;订单创建成功&quot;</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 可选的通知服务</span></span><br><span class="line">            <span class="keyword">if</span> (notificationService != <span class="literal">null</span>) &#123;</span><br><span class="line">                notificationService.sendPushNotification(user.getId(), <span class="string">&quot;您的订单已创建&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> order;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Qualifier-指定具体Bean"><a href="#Qualifier-指定具体Bean" class="headerlink" title="@Qualifier - 指定具体Bean"></a>@Qualifier - 指定具体Bean</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Qualifier</span>: 当有多个同类型Bean时，指定要注入哪一个</span></span><br><span class="line"><span class="comment"> * 场景：一个接口有多个实现类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PaymentService</span> &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">processPayment</span><span class="params">(BigDecimal amount)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现类1</span></span><br><span class="line"><span class="meta">@Service(&quot;alipayService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AlipayService</span> <span class="keyword">implements</span> <span class="title class_">PaymentService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">processPayment</span><span class="params">(BigDecimal amount)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;使用支付宝支付: &quot;</span> + amount);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现类2</span></span><br><span class="line"><span class="meta">@Service(&quot;wechatPayService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WechatPayService</span> <span class="keyword">implements</span> <span class="title class_">PaymentService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">processPayment</span><span class="params">(BigDecimal amount)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;使用微信支付: &quot;</span> + amount);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用时指定具体的实现</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="meta">@Qualifier(&quot;alipayService&quot;)</span> <span class="comment">// 明确指定使用支付宝服务</span></span><br><span class="line">    <span class="keyword">private</span> PaymentService paymentService;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 或者使用构造器注入</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">OrderService</span><span class="params">(<span class="meta">@Qualifier(&quot;wechatPayService&quot;)</span> PaymentService paymentService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.paymentService = paymentService;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Value-属性值注入"><a href="#Value-属性值注入" class="headerlink" title="@Value - 属性值注入"></a>@Value - 属性值注入</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Value</span>: 注入配置文件中的属性值</span></span><br><span class="line"><span class="comment"> * 功能：从application.properties或application.yml读取配置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// application.properties文件内容：</span></span><br><span class="line"><span class="comment">// app.name=我的应用</span></span><br><span class="line"><span class="comment">// app.version=1.0.0</span></span><br><span class="line"><span class="comment">// database.url=jdbc:mysql://localhost:3306/mydb</span></span><br><span class="line"><span class="comment">// email.smtp.host=smtp.gmail.com</span></span><br><span class="line"><span class="comment">// email.smtp.port=587</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfigService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 注入简单属性值</span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;app.name&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String appName;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;app.version&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String appVersion;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 注入数字类型</span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;email.smtp.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> smtpPort;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 提供默认值（如果配置文件中没有该属性）</span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;app.debug:false&#125;&quot;)</span> <span class="comment">// 默认值为false</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> debugMode;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;app.max-users:1000&#125;&quot;)</span> <span class="comment">// 默认值为1000</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> maxUsers;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 注入系统属性</span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;java.version&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String javaVersion;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 注入环境变量</span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;HOME&#125;&quot;)</span> <span class="comment">// Unix/Linux系统的HOME环境变量</span></span><br><span class="line">    <span class="keyword">private</span> String homeDirectory;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printConfig</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;应用名称: &quot;</span> + appName);</span><br><span class="line">        System.out.println(<span class="string">&quot;应用版本: &quot;</span> + appVersion);</span><br><span class="line">        System.out.println(<span class="string">&quot;SMTP端口: &quot;</span> + smtpPort);</span><br><span class="line">        System.out.println(<span class="string">&quot;调试模式: &quot;</span> + debugMode);</span><br><span class="line">        System.out.println(<span class="string">&quot;最大用户数: &quot;</span> + maxUsers);</span><br><span class="line">        System.out.println(<span class="string">&quot;Java版本: &quot;</span> + javaVersion);</span><br><span class="line">        System.out.println(<span class="string">&quot;主目录: &quot;</span> + homeDirectory);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-2-Spring-Boot注解详解"><a href="#6-2-Spring-Boot注解详解" class="headerlink" title="6.2 Spring Boot注解详解"></a>6.2 Spring Boot注解详解</h3><h5 id="SpringBootApplication-启动类注解"><a href="#SpringBootApplication-启动类注解" class="headerlink" title="@SpringBootApplication - 启动类注解"></a>@SpringBootApplication - 启动类注解</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@SpringBootApplication</span>: Spring Boot应用的核心注解</span></span><br><span class="line"><span class="comment"> * 功能：这是一个组合注解，等价于以下三个注解的组合：</span></span><br><span class="line"><span class="comment"> * 1. <span class="doctag">@Configuration</span>: 标记这是一个配置类</span></span><br><span class="line"><span class="comment"> * 2. <span class="doctag">@EnableAutoConfiguration</span>: 启用Spring Boot的自动配置</span></span><br><span class="line"><span class="comment"> * 3. <span class="doctag">@ComponentScan</span>: 启用组件扫描</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 启动Spring Boot应用</span></span><br><span class="line">        SpringApplication.run(MyApplication.class, args);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * 这一行代码会：</span></span><br><span class="line"><span class="comment">         * 1. 创建Spring应用上下文</span></span><br><span class="line"><span class="comment">         * 2. 扫描当前包及子包中的@Component、@Service等注解</span></span><br><span class="line"><span class="comment">         * 3. 根据classpath中的依赖自动配置Bean</span></span><br><span class="line"><span class="comment">         * 4. 启动内嵌的Web服务器（如Tomcat）</span></span><br><span class="line"><span class="comment">         * 5. 部署应用到服务器上</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果需要自定义配置，可以分别使用：</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackages = &#123;&quot;com.example.service&quot;, &quot;com.example.repository&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomApplication</span> &#123;</span><br><span class="line">    <span class="comment">// 自定义配置</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="REST-API注解系列"><a href="#REST-API注解系列" class="headerlink" title="REST API注解系列"></a>REST API注解系列</h5><h5 id="RestController-REST控制器注解"><a href="#RestController-REST控制器注解" class="headerlink" title="@RestController - REST控制器注解"></a>@RestController - REST控制器注解</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@RestController</span>: REST API控制器注解</span></span><br><span class="line"><span class="comment"> * 功能：等价于 <span class="doctag">@Controller</span> + <span class="doctag">@ResponseBody</span></span></span><br><span class="line"><span class="comment"> * 特点：方法返回的对象会自动转换为JSON格式返回给客户端</span></span><br><span class="line"><span class="comment"> * 用途：构建RESTful Web服务</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/v1&quot;)</span> <span class="comment">// 基础路径</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserRestController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * GET /api/v1/users - 获取所有用户</span></span><br><span class="line"><span class="comment">     * 返回JSON格式的用户列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/users&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">getAllUsers</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userService.getAllUsers();</span><br><span class="line">        <span class="comment">// Spring会自动将List&lt;User&gt;转换为JSON数组返回</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * GET /api/v1/users/123 - 根据ID获取用户</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@PathVariable</span>: 从URL路径中提取参数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/users/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;User&gt; <span class="title function_">getUserById</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.findById(id);</span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.ok(user); <span class="comment">// 返回200状态码和用户数据</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (UserNotFoundException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.notFound().build(); <span class="comment">// 返回404状态码</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * POST /api/v1/users - 创建新用户</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@RequestBody</span>: 将请求体中的JSON转换为Java对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/users&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;User&gt; <span class="title function_">createUser</span><span class="params">(<span class="meta">@RequestBody</span> CreateUserRequest request)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.createUser(request.getUsername(), request.getEmail());</span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.status(HttpStatus.CREATED).body(user); <span class="comment">// 返回201状态码</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalArgumentException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.badRequest().build(); <span class="comment">// 返回400状态码</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * PUT /api/v1/users/123 - 更新用户信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PutMapping(&quot;/users/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;User&gt; <span class="title function_">updateUser</span><span class="params">(<span class="meta">@PathVariable</span> Long id, </span></span><br><span class="line"><span class="params">                                         <span class="meta">@RequestBody</span> UpdateUserRequest request)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.updateUser(id, request.getUsername(), request.getEmail());</span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.ok(user);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (UserNotFoundException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.notFound().build();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * DELETE /api/v1/users/123 - 删除用户</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;/users/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;Void&gt; <span class="title function_">deleteUser</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            userService.deleteUser(id);</span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.noContent().build(); <span class="comment">// 返回204状态码</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (UserNotFoundException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.notFound().build();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * GET /api/v1/users?page=0&amp;size=10&amp;sort=username - 分页查询</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@RequestParam</span>: 从URL查询参数中提取值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/users&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;Page&lt;User&gt;&gt; <span class="title function_">getUsers</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(defaultValue = &quot;0&quot;)</span> <span class="type">int</span> page,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(defaultValue = &quot;10&quot;)</span> <span class="type">int</span> size,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(defaultValue = &quot;id&quot;)</span> String sort)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="type">PageRequest</span> <span class="variable">pageRequest</span> <span class="operator">=</span> PageRequest.of(page, size, Sort.by(sort));</span><br><span class="line">        Page&lt;User&gt; users = userService.getUsers(pageRequest);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(users);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="HTTP方法映射注解详解"><a href="#HTTP方法映射注解详解" class="headerlink" title="HTTP方法映射注解详解"></a>HTTP方法映射注解详解</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * HTTP方法映射注解详解</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/products&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProductController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@GetMapping</span>: 处理GET请求</span></span><br><span class="line"><span class="comment">     * 用途：获取资源，不会修改服务器状态</span></span><br><span class="line"><span class="comment">     * 特点：幂等（多次调用结果相同）、可缓存</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping</span> <span class="comment">// 等价于 @RequestMapping(method = RequestMethod.GET)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Product&gt; <span class="title function_">getAllProducts</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> productService.findAll();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Product <span class="title function_">getProduct</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> productService.findById(id);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@PostMapping</span>: 处理POST请求</span></span><br><span class="line"><span class="comment">     * 用途：创建新资源</span></span><br><span class="line"><span class="comment">     * 特点：非幂等（多次调用可能产生不同结果）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;Product&gt; <span class="title function_">createProduct</span><span class="params">(<span class="meta">@RequestBody</span> Product product)</span> &#123;</span><br><span class="line">        <span class="type">Product</span> <span class="variable">created</span> <span class="operator">=</span> productService.save(product);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.status(HttpStatus.CREATED).body(created);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@PutMapping</span>: 处理PUT请求</span></span><br><span class="line"><span class="comment">     * 用途：完整更新资源（替换整个资源）</span></span><br><span class="line"><span class="comment">     * 特点：幂等</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PutMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;Product&gt; <span class="title function_">updateProduct</span><span class="params">(<span class="meta">@PathVariable</span> Long id, </span></span><br><span class="line"><span class="params">                                               <span class="meta">@RequestBody</span> Product product)</span> &#123;</span><br><span class="line">        product.setId(id);</span><br><span class="line">        <span class="type">Product</span> <span class="variable">updated</span> <span class="operator">=</span> productService.save(product);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(updated);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@PatchMapping</span>: 处理PATCH请求</span></span><br><span class="line"><span class="comment">     * 用途：部分更新资源（只更新指定字段）</span></span><br><span class="line"><span class="comment">     * 特点：幂等</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PatchMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;Product&gt; <span class="title function_">patchProduct</span><span class="params">(<span class="meta">@PathVariable</span> Long id, </span></span><br><span class="line"><span class="params">                                              <span class="meta">@RequestBody</span> Map&lt;String, Object&gt; updates)</span> &#123;</span><br><span class="line">        <span class="type">Product</span> <span class="variable">updated</span> <span class="operator">=</span> productService.partialUpdate(id, updates);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(updated);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@DeleteMapping</span>: 处理DELETE请求</span></span><br><span class="line"><span class="comment">     * 用途：删除资源</span></span><br><span class="line"><span class="comment">     * 特点：幂等</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;Void&gt; <span class="title function_">deleteProduct</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">        productService.delete(id);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.noContent().build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="参数绑定注解详解"><a href="#参数绑定注解详解" class="headerlink" title="参数绑定注解详解"></a>参数绑定注解详解</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/search&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SearchController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@PathVariable</span>: 从URL路径中提取变量</span></span><br><span class="line"><span class="comment">     * URL示例: /api/search/users/123/orders/456</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/users/&#123;userId&#125;/orders/&#123;orderId&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Order <span class="title function_">getUserOrder</span><span class="params">(<span class="meta">@PathVariable</span> Long userId, </span></span><br><span class="line"><span class="params">                            <span class="meta">@PathVariable</span> Long orderId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> orderService.findByUserIdAndOrderId(userId, orderId);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 路径变量名称与参数名不同时</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/products/&#123;productId&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Product <span class="title function_">getProduct</span><span class="params">(<span class="meta">@PathVariable(&quot;productId&quot;)</span> Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> productService.findById(id);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@RequestParam</span>: 从URL查询参数中提取值</span></span><br><span class="line"><span class="comment">     * URL示例: /api/search/products?keyword=手机&amp;category=电子&amp;minPrice=1000&amp;maxPrice=5000</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/products&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Product&gt; <span class="title function_">searchProducts</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam</span> String keyword,                    // 必需参数</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(required = false)</span> String category, // 可选参数</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(defaultValue = &quot;0&quot;)</span> BigDecimal minPrice, // 有默认值</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(defaultValue = &quot;999999&quot;)</span> BigDecimal maxPrice)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> productService.search(keyword, category, minPrice, maxPrice);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@RequestHeader</span>: 从HTTP请求头中提取值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/secure-data&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;String&gt; <span class="title function_">getSecureData</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestHeader(&quot;Authorization&quot;)</span> String authToken,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestHeader(value = &quot;User-Agent&quot;, required = false)</span> String userAgent,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestHeader(defaultValue = &quot;application/json&quot;)</span> String accept)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!isValidToken(authToken)) &#123;</span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.status(HttpStatus.UNAUTHORIZED).build();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(<span class="string">&quot;安全数据&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@RequestBody</span>: 将请求体内容绑定到对象</span></span><br><span class="line"><span class="comment">     * 常用于POST/PUT请求，自动将JSON转换为Java对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/users&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">createUser</span><span class="params">(<span class="meta">@RequestBody</span> CreateUserRequest request)</span> &#123;</span><br><span class="line">        <span class="comment">// Spring自动将请求体中的JSON转换为CreateUserRequest对象</span></span><br><span class="line">        <span class="keyword">return</span> userService.createUser(request);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@ModelAttribute</span>: 将请求参数绑定到对象（适用于表单提交）</span></span><br><span class="line"><span class="comment">     * 适用于传统的表单提交，参数以key=value形式提交</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/users/form&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">createUserForm</span><span class="params">(<span class="meta">@ModelAttribute</span> User user, Model model)</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">created</span> <span class="operator">=</span> userService.save(user);</span><br><span class="line">        model.addAttribute(<span class="string">&quot;user&quot;</span>, created);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;user-created&quot;</span>; <span class="comment">// 返回视图名称</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="REST-API完整示例"><a href="#REST-API完整示例" class="headerlink" title="REST API完整示例"></a>REST API完整示例</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 完整的REST API示例：用户管理</span></span><br><span class="line"><span class="comment"> * 展示了标准的RESTful设计模式</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/v1/users&quot;)</span></span><br><span class="line"><span class="meta">@Validated</span> <span class="comment">// 启用参数验证</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserApiController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// GET /api/v1/users - 获取用户列表（支持分页和搜索）</span></span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;ApiResponse&lt;Page&lt;UserDto&gt;&gt;&gt; <span class="title function_">getUsers</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(defaultValue = &quot;0&quot;)</span> <span class="type">int</span> page,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(defaultValue = &quot;10&quot;)</span> <span class="type">int</span> size,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(defaultValue = &quot;id&quot;)</span> String sort,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(defaultValue = &quot;asc&quot;)</span> String direction,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(required = false)</span> String search)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        Sort.<span class="type">Direction</span> <span class="variable">sortDirection</span> <span class="operator">=</span> <span class="string">&quot;desc&quot;</span>.equalsIgnoreCase(direction) ? </span><br><span class="line">                                     Sort.Direction.DESC : Sort.Direction.ASC;</span><br><span class="line">        <span class="type">Pageable</span> <span class="variable">pageable</span> <span class="operator">=</span> PageRequest.of(page, size, Sort.by(sortDirection, sort));</span><br><span class="line">        </span><br><span class="line">        Page&lt;UserDto&gt; users = userService.findUsers(search, pageable);</span><br><span class="line">        </span><br><span class="line">        ApiResponse&lt;Page&lt;UserDto&gt;&gt; response = ApiResponse.&lt;Page&lt;UserDto&gt;&gt;builder()</span><br><span class="line">            .success(<span class="literal">true</span>)</span><br><span class="line">            .message(<span class="string">&quot;用户列表获取成功&quot;</span>)</span><br><span class="line">            .data(users)</span><br><span class="line">            .timestamp(LocalDateTime.now())</span><br><span class="line">            .build();</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(response);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// GET /api/v1/users/123 - 获取单个用户</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;ApiResponse&lt;UserDto&gt;&gt; <span class="title function_">getUser</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">UserDto</span> <span class="variable">user</span> <span class="operator">=</span> userService.findById(id);</span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.ok(ApiResponse.success(<span class="string">&quot;用户信息获取成功&quot;</span>, user));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (UserNotFoundException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.status(HttpStatus.NOT_FOUND)</span><br><span class="line">                .body(ApiResponse.error(<span class="string">&quot;用户不存在&quot;</span>, <span class="literal">null</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// POST /api/v1/users - 创建用户</span></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;ApiResponse&lt;UserDto&gt;&gt; <span class="title function_">createUser</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@Valid</span> <span class="meta">@RequestBody</span> CreateUserRequest request)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">UserDto</span> <span class="variable">user</span> <span class="operator">=</span> userService.createUser(request);</span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.status(HttpStatus.CREATED)</span><br><span class="line">                .body(ApiResponse.success(<span class="string">&quot;用户创建成功&quot;</span>, user));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (DuplicateUsernameException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.status(HttpStatus.CONFLICT)</span><br><span class="line">                .body(ApiResponse.error(<span class="string">&quot;用户名已存在&quot;</span>, <span class="literal">null</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// PUT /api/v1/users/123 - 更新用户</span></span><br><span class="line">    <span class="meta">@PutMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;ApiResponse&lt;UserDto&gt;&gt; <span class="title function_">updateUser</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@PathVariable</span> Long id,</span></span><br><span class="line"><span class="params">            <span class="meta">@Valid</span> <span class="meta">@RequestBody</span> UpdateUserRequest request)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">UserDto</span> <span class="variable">user</span> <span class="operator">=</span> userService.updateUser(id, request);</span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.ok(ApiResponse.success(<span class="string">&quot;用户更新成功&quot;</span>, user));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (UserNotFoundException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.status(HttpStatus.NOT_FOUND)</span><br><span class="line">                .body(ApiResponse.error(<span class="string">&quot;用户不存在&quot;</span>, <span class="literal">null</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// DELETE /api/v1/users/123 - 删除用户</span></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;ApiResponse&lt;Void&gt;&gt; <span class="title function_">deleteUser</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            userService.deleteUser(id);</span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.ok(ApiResponse.success(<span class="string">&quot;用户删除成功&quot;</span>, <span class="literal">null</span>));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (UserNotFoundException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.status(HttpStatus.NOT_FOUND)</span><br><span class="line">                .body(ApiResponse.error(<span class="string">&quot;用户不存在&quot;</span>, <span class="literal">null</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// POST /api/v1/users/123/avatar - 上传用户头像</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/&#123;id&#125;/avatar&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;ApiResponse&lt;String&gt;&gt; <span class="title function_">uploadAvatar</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@PathVariable</span> Long id,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(&quot;file&quot;)</span> MultipartFile file)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">avatarUrl</span> <span class="operator">=</span> userService.uploadAvatar(id, file);</span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.ok(ApiResponse.success(<span class="string">&quot;头像上传成功&quot;</span>, avatarUrl));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR)</span><br><span class="line">                .body(ApiResponse.error(<span class="string">&quot;头像上传失败&quot;</span>, <span class="literal">null</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 统一的API响应格式</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApiResponse</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> success;</span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line">    <span class="keyword">private</span> T data;</span><br><span class="line">    <span class="keyword">private</span> LocalDateTime timestamp;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; ApiResponse&lt;T&gt; <span class="title function_">success</span><span class="params">(String message, T data)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ApiResponse.&lt;T&gt;builder()</span><br><span class="line">            .success(<span class="literal">true</span>)</span><br><span class="line">            .message(message)</span><br><span class="line">            .data(data)</span><br><span class="line">            .timestamp(LocalDateTime.now())</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; ApiResponse&lt;T&gt; <span class="title function_">error</span><span class="params">(String message, T data)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ApiResponse.&lt;T&gt;builder()</span><br><span class="line">            .success(<span class="literal">false</span>)</span><br><span class="line">            .message(message)</span><br><span class="line">            .data(data)</span><br><span class="line">            .timestamp(LocalDateTime.now())</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-3-JPA-Hibernate注解详解"><a href="#6-3-JPA-Hibernate注解详解" class="headerlink" title="6.3 JPA&#x2F;Hibernate注解详解"></a>6.3 JPA&#x2F;Hibernate注解详解</h3><p>**JPA（Java Persistence API）**是Java的数据持久化标准，<strong>Hibernate</strong>是JPA的最流行实现。这些注解用于将Java对象映射到数据库表。</p>
<h4 id="核心实体注解"><a href="#核心实体注解" class="headerlink" title="核心实体注解"></a>核心实体注解</h4><h5 id="Entity-实体类注解"><a href="#Entity-实体类注解" class="headerlink" title="@Entity - 实体类注解"></a>@Entity - 实体类注解</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Entity</span>: 标记这是一个JPA实体类</span></span><br><span class="line"><span class="comment"> * 功能：告诉JPA这个类对应数据库中的一张表</span></span><br><span class="line"><span class="comment"> * 要求：</span></span><br><span class="line"><span class="comment"> * 1. 必须有一个无参构造器</span></span><br><span class="line"><span class="comment"> * 2. 必须有一个主键字段（用<span class="doctag">@Id</span>标记）</span></span><br><span class="line"><span class="comment"> * 3. 字段不能是final的</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;users&quot;)</span> <span class="comment">// 可选：指定数据库表名，不指定则使用类名</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Id</span> <span class="comment">// 标记主键字段</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span> <span class="comment">// 主键生成策略</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Column(name = &quot;username&quot;, nullable = false, unique = true, length = 50)</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Column(name = &quot;email&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Column(name = &quot;created_at&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createdAt;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 必须有无参构造器</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(String username, String email)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.username = username;</span><br><span class="line">        <span class="built_in">this</span>.email = email;</span><br><span class="line">        <span class="built_in">this</span>.createdAt = LocalDateTime.now();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// getter和setter方法...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Table-表映射注解"><a href="#Table-表映射注解" class="headerlink" title="@Table - 表映射注解"></a>@Table - 表映射注解</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Table</span>: 指定实体对应的数据库表的详细信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(</span></span><br><span class="line"><span class="meta">    name = &quot;user_profiles&quot;,           // 表名</span></span><br><span class="line"><span class="meta">    catalog = &quot;myapp_db&quot;,            // 数据库名（可选）</span></span><br><span class="line"><span class="meta">    schema = &quot;public&quot;,               // 模式名（可选）</span></span><br><span class="line"><span class="meta">    uniqueConstraints = &#123;            // 唯一约束</span></span><br><span class="line"><span class="meta">        @UniqueConstraint(</span></span><br><span class="line"><span class="meta">            name = &quot;uk_user_email&quot;, </span></span><br><span class="line"><span class="meta">            columnNames = &#123;&quot;user_id&quot;, &quot;email&quot;&#125;</span></span><br><span class="line"><span class="meta">        )</span></span><br><span class="line"><span class="meta">    &#125;,</span></span><br><span class="line"><span class="meta">    indexes = &#123;                      // 索引</span></span><br><span class="line"><span class="meta">        @Index(name = &quot;idx_user_email&quot;, columnList = &quot;email&quot;),</span></span><br><span class="line"><span class="meta">        @Index(name = &quot;idx_user_created&quot;, columnList = &quot;created_at&quot;)</span></span><br><span class="line"><span class="meta">    &#125;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserProfile</span> &#123;</span><br><span class="line">    <span class="comment">// 字段定义...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Id-和主键生成策略"><a href="#Id-和主键生成策略" class="headerlink" title="@Id 和主键生成策略"></a>@Id 和主键生成策略</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Product</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Id</span>: 标记主键字段</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@GeneratedValue</span>: 主键值生成策略</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 策略1: AUTO - 让JPA自动选择合适的策略</span></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.AUTO)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 策略2: IDENTITY - 使用数据库的自增字段（MySQL的AUTO_INCREMENT）</span></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 策略3: SEQUENCE - 使用数据库序列（Oracle、PostgreSQL）</span></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.SEQUENCE, generator = &quot;product_seq&quot;)</span></span><br><span class="line">    <span class="meta">@SequenceGenerator(name = &quot;product_seq&quot;, sequenceName = &quot;product_sequence&quot;, allocationSize = 1)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 策略4: TABLE - 使用单独的表来生成主键</span></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.TABLE, generator = &quot;product_gen&quot;)</span></span><br><span class="line">    <span class="meta">@TableGenerator(name = &quot;product_gen&quot;, table = &quot;id_generator&quot;, </span></span><br><span class="line"><span class="meta">                   pkColumnName = &quot;gen_name&quot;, valueColumnName = &quot;gen_value&quot;,</span></span><br><span class="line"><span class="meta">                   pkColumnValue = &quot;product_id&quot;, allocationSize = 1)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 复合主键：使用@IdClass或@EmbeddedId</span></span><br><span class="line">    <span class="comment">// 方式1: @IdClass</span></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="keyword">private</span> Long userId;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="keyword">private</span> Long productId;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 字段定义...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 复合主键类</span></span><br><span class="line"><span class="meta">@IdClass(UserProductId.class)</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserProduct</span> &#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="keyword">private</span> Long userId;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="keyword">private</span> Long productId;</span><br><span class="line">    <span class="keyword">private</span> Integer quantity;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 主键类必须实现Serializable</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserProductId</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long userId;</span><br><span class="line">    <span class="keyword">private</span> Long productId;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 必须重写equals和hashCode</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object o)</span> &#123; <span class="comment">/* ... */</span> &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span> &#123; <span class="comment">/* ... */</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Column-字段映射注解"><a href="#Column-字段映射注解" class="headerlink" title="@Column - 字段映射注解"></a>@Column - 字段映射注解</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Column</span>: 指定字段映射到数据库列的详细信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 基本用法</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;user_name&quot;)</span>  <span class="comment">// 指定数据库列名</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 详细配置</span></span><br><span class="line">    <span class="meta">@Column(</span></span><br><span class="line"><span class="meta">        name = &quot;email_address&quot;,      // 列名</span></span><br><span class="line"><span class="meta">        nullable = false,            // 不能为null（相当于NOT NULL约束）</span></span><br><span class="line"><span class="meta">        unique = true,              // 唯一约束</span></span><br><span class="line"><span class="meta">        length = 255,               // 字符串长度（varchar(255)）</span></span><br><span class="line"><span class="meta">        columnDefinition = &quot;TEXT&quot;   // 自定义列定义</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 数字类型配置</span></span><br><span class="line">    <span class="meta">@Column(</span></span><br><span class="line"><span class="meta">        name = &quot;salary&quot;,</span></span><br><span class="line"><span class="meta">        precision = 10,  // 总位数</span></span><br><span class="line"><span class="meta">        scale = 2        // 小数位数（decimal(10,2)）</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal salary;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 不需要映射到数据库的字段</span></span><br><span class="line">    <span class="meta">@Transient</span></span><br><span class="line">    <span class="keyword">private</span> String tempPassword; <span class="comment">// 这个字段不会保存到数据库</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 时间类型</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;birth_date&quot;)</span></span><br><span class="line">    <span class="meta">@Temporal(TemporalType.DATE)</span>      <span class="comment">// 只保存日期部分</span></span><br><span class="line">    <span class="keyword">private</span> Date birthDate;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Column(name = &quot;created_at&quot;)</span></span><br><span class="line">    <span class="meta">@Temporal(TemporalType.TIMESTAMP)</span> <span class="comment">// 保存日期和时间</span></span><br><span class="line">    <span class="keyword">private</span> Date createdAt;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Column(name = &quot;login_time&quot;)</span></span><br><span class="line">    <span class="meta">@Temporal(TemporalType.TIME)</span>      <span class="comment">// 只保存时间部分</span></span><br><span class="line">    <span class="keyword">private</span> Date loginTime;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 枚举类型</span></span><br><span class="line">    <span class="meta">@Enumerated(EnumType.STRING)</span>      <span class="comment">// 保存枚举的字符串值</span></span><br><span class="line">    <span class="keyword">private</span> UserStatus status;        <span class="comment">// 如：ACTIVE, INACTIVE, BANNED</span></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Enumerated(EnumType.ORDINAL)</span>     <span class="comment">// 保存枚举的序号值</span></span><br><span class="line">    <span class="keyword">private</span> UserRole role;            <span class="comment">// 如：0, 1, 2</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 大对象类型</span></span><br><span class="line">    <span class="meta">@Lob</span>  <span class="comment">// Large Object：用于存储大文本或二进制数据</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;profile_photo&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">byte</span>[] photo;             <span class="comment">// 存储图片</span></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Lob</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;description&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String description;       <span class="comment">// 存储长文本</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 枚举类型示例</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">UserStatus</span> &#123;</span><br><span class="line">    ACTIVE, INACTIVE, BANNED, SUSPENDED</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">UserRole</span> &#123;</span><br><span class="line">    USER, ADMIN, MODERATOR</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="关联关系注解"><a href="#关联关系注解" class="headerlink" title="关联关系注解"></a>关联关系注解</h4><h5 id="OneToOne-一对一关系"><a href="#OneToOne-一对一关系" class="headerlink" title="@OneToOne - 一对一关系"></a>@OneToOne - 一对一关系</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 一对一关系：一个用户对应一个用户详情</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 主表（拥有外键的一方）</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@OneToOne</span>: 一对一关系</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@JoinColumn</span>: 指定外键列</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@OneToOne(cascade = CascadeType.ALL, fetch = FetchType.LAZY)</span></span><br><span class="line">    <span class="meta">@JoinColumn(name = &quot;profile_id&quot;, referencedColumnName = &quot;id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> UserProfile profile;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 构造器、getter、setter...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 从表</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserProfile</span> &#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String firstName;</span><br><span class="line">    <span class="keyword">private</span> String lastName;</span><br><span class="line">    <span class="keyword">private</span> String bio;</span><br><span class="line">    <span class="keyword">private</span> String avatarUrl;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 双向关联：从UserProfile也能访问User</span></span><br><span class="line">    <span class="meta">@OneToOne(mappedBy = &quot;profile&quot;)</span> <span class="comment">// mappedBy指向User类中的profile字段</span></span><br><span class="line">    <span class="keyword">private</span> User user;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 构造器、getter、setter...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserRepository userRepository;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">createUserWithProfile</span><span class="params">(String username, String firstName, String lastName)</span> &#123;</span><br><span class="line">        <span class="comment">// 创建用户详情</span></span><br><span class="line">        <span class="type">UserProfile</span> <span class="variable">profile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserProfile</span>();</span><br><span class="line">        profile.setFirstName(firstName);</span><br><span class="line">        profile.setLastName(lastName);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 创建用户</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setUsername(username);</span><br><span class="line">        user.setProfile(profile);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 设置双向关联</span></span><br><span class="line">        profile.setUser(user);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 由于设置了cascade = CascadeType.ALL，保存user时会自动保存profile</span></span><br><span class="line">        <span class="keyword">return</span> userRepository.save(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="OneToMany-一对多关系"><a href="#OneToMany-一对多关系" class="headerlink" title="@OneToMany - 一对多关系"></a>@OneToMany - 一对多关系</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 一对多关系：一个用户可以有多个订单</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// &quot;一&quot;的一方：User</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@OneToMany</span>: 一对多关系</span></span><br><span class="line"><span class="comment">     * mappedBy: 指向Order类中的user字段（表示外键在Order表中）</span></span><br><span class="line"><span class="comment">     * cascade: 级联操作（保存用户时自动处理订单）</span></span><br><span class="line"><span class="comment">     * fetch: 加载策略（LAZY表示需要时才加载订单列表）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@OneToMany(mappedBy = &quot;user&quot;, cascade = CascadeType.ALL, fetch = FetchType.LAZY)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Order&gt; orders = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 便利方法：添加订单</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addOrder</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        orders.add(order);</span><br><span class="line">        order.setUser(<span class="built_in">this</span>); <span class="comment">// 设置双向关联</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 便利方法：移除订单</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">removeOrder</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        orders.remove(order);</span><br><span class="line">        order.setUser(<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// &quot;多&quot;的一方：Order</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Order</span> &#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> BigDecimal totalAmount;</span><br><span class="line">    <span class="keyword">private</span> LocalDateTime orderTime;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@ManyToOne</span>: 多对一关系（从Order的角度看，多个订单对应一个用户）</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@JoinColumn</span>: 指定外键列名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ManyToOne(fetch = FetchType.LAZY)</span></span><br><span class="line">    <span class="meta">@JoinColumn(name = &quot;user_id&quot;, nullable = false)</span></span><br><span class="line">    <span class="keyword">private</span> User user;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 构造器、getter、setter...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Order <span class="title function_">createOrder</span><span class="params">(Long userId, BigDecimal amount)</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userRepository.findById(userId)</span><br><span class="line">            .orElseThrow(() -&gt; <span class="keyword">new</span> <span class="title class_">UserNotFoundException</span>(<span class="string">&quot;用户不存在&quot;</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Order</span>();</span><br><span class="line">        order.setTotalAmount(amount);</span><br><span class="line">        order.setOrderTime(LocalDateTime.now());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 建立关联关系</span></span><br><span class="line">        user.addOrder(order);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> orderRepository.save(order);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取用户的所有订单</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Order&gt; <span class="title function_">getUserOrders</span><span class="params">(Long userId)</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userRepository.findById(userId)</span><br><span class="line">            .orElseThrow(() -&gt; <span class="keyword">new</span> <span class="title class_">UserNotFoundException</span>(<span class="string">&quot;用户不存在&quot;</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 由于使用了LAZY加载，这里会触发数据库查询</span></span><br><span class="line">        <span class="keyword">return</span> user.getOrders();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="ManyToMany-多对多关系"><a href="#ManyToMany-多对多关系" class="headerlink" title="@ManyToMany - 多对多关系"></a>@ManyToMany - 多对多关系</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 多对多关系：用户和角色的关系（一个用户可以有多个角色，一个角色可以分配给多个用户）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 主控方：User</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@ManyToMany</span>: 多对多关系</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@JoinTable</span>: 指定中间表的信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ManyToMany(cascade = &#123;CascadeType.PERSIST, CascadeType.MERGE&#125;, fetch = FetchType.LAZY)</span></span><br><span class="line">    <span class="meta">@JoinTable(</span></span><br><span class="line"><span class="meta">        name = &quot;user_roles&quot;,                    // 中间表名</span></span><br><span class="line"><span class="meta">        joinColumns = @JoinColumn(name = &quot;user_id&quot;),     // 当前实体的外键列</span></span><br><span class="line"><span class="meta">        inverseJoinColumns = @JoinColumn(name = &quot;role_id&quot;) // 关联实体的外键列</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    <span class="keyword">private</span> Set&lt;Role&gt; roles = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 便利方法：添加角色</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addRole</span><span class="params">(Role role)</span> &#123;</span><br><span class="line">        roles.add(role);</span><br><span class="line">        role.getUsers().add(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 便利方法：移除角色</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">removeRole</span><span class="params">(Role role)</span> &#123;</span><br><span class="line">        roles.remove(role);</span><br><span class="line">        role.getUsers().remove(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 被控方：Role</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Role</span> &#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String name; <span class="comment">// ADMIN, USER, MODERATOR等</span></span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * mappedBy: 指向User类中的roles字段，表示这是关系的被控方</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ManyToMany(mappedBy = &quot;roles&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Set&lt;User&gt; users = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 构造器、getter、setter...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 带额外信息的多对多关系：用户和课程的关系（包含注册时间、成绩等额外信息）</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@OneToMany(mappedBy = &quot;user&quot;, cascade = CascadeType.ALL)</span></span><br><span class="line">    <span class="keyword">private</span> Set&lt;UserCourse&gt; userCourses = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Course</span> &#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@OneToMany(mappedBy = &quot;course&quot;, cascade = CascadeType.ALL)</span></span><br><span class="line">    <span class="keyword">private</span> Set&lt;UserCourse&gt; userCourses = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 中间实体：包含额外信息</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;user_courses&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserCourse</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@EmbeddedId</span></span><br><span class="line">    <span class="keyword">private</span> UserCourseId id;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ManyToOne</span></span><br><span class="line">    <span class="meta">@MapsId(&quot;userId&quot;)</span> <span class="comment">// 映射到复合主键的userId部分</span></span><br><span class="line">    <span class="meta">@JoinColumn(name = &quot;user_id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> User user;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ManyToOne</span></span><br><span class="line">    <span class="meta">@MapsId(&quot;courseId&quot;)</span> <span class="comment">// 映射到复合主键的courseId部分</span></span><br><span class="line">    <span class="meta">@JoinColumn(name = &quot;course_id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Course course;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 额外信息</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime enrollmentDate;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal grade;</span><br><span class="line">    <span class="keyword">private</span> String status; <span class="comment">// ENROLLED, COMPLETED, DROPPED</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 构造器、getter、setter...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 复合主键</span></span><br><span class="line"><span class="meta">@Embeddable</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserCourseId</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long userId;</span><br><span class="line">    <span class="keyword">private</span> Long courseId;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 必须重写equals和hashCode</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object o)</span> &#123; <span class="comment">/* ... */</span> &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span> &#123; <span class="comment">/* ... */</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="级联操作和获取策略"><a href="#级联操作和获取策略" class="headerlink" title="级联操作和获取策略"></a>级联操作和获取策略</h4><h5 id="级联操作（Cascade）"><a href="#级联操作（Cascade）" class="headerlink" title="级联操作（Cascade）"></a>级联操作（Cascade）</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 级联操作类型：</span></span><br><span class="line"><span class="comment">     * CascadeType.PERSIST: 保存用户时，自动保存关联的订单</span></span><br><span class="line"><span class="comment">     * CascadeType.MERGE: 更新用户时，自动更新关联的订单</span></span><br><span class="line"><span class="comment">     * CascadeType.REMOVE: 删除用户时，自动删除关联的订单</span></span><br><span class="line"><span class="comment">     * CascadeType.REFRESH: 刷新用户时，自动刷新关联的订单</span></span><br><span class="line"><span class="comment">     * CascadeType.DETACH: 分离用户时，自动分离关联的订单</span></span><br><span class="line"><span class="comment">     * CascadeType.ALL: 包含所有上述操作</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 删除用户时不会删除订单（业务需要保留订单记录）</span></span><br><span class="line">    <span class="meta">@OneToMany(mappedBy = &quot;user&quot;, cascade = &#123;CascadeType.PERSIST, CascadeType.MERGE&#125;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Order&gt; orders;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 删除用户时会删除用户详情（因为详情没有独立存在的意义）</span></span><br><span class="line">    <span class="meta">@OneToOne(cascade = CascadeType.ALL)</span></span><br><span class="line">    <span class="keyword">private</span> UserProfile profile;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 不会删除角色（角色是独立的实体，可能被其他用户使用）</span></span><br><span class="line">    <span class="meta">@ManyToMany(cascade = &#123;CascadeType.PERSIST, CascadeType.MERGE&#125;)</span></span><br><span class="line">    <span class="keyword">private</span> Set&lt;Role&gt; roles;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="获取策略（Fetch）"><a href="#获取策略（Fetch）" class="headerlink" title="获取策略（Fetch）"></a>获取策略（Fetch）</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取策略：</span></span><br><span class="line"><span class="comment">     * FetchType.LAZY（懒加载）: 需要时才从数据库加载</span></span><br><span class="line"><span class="comment">     * FetchType.EAGER（急加载）: 立即从数据库加载</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 懒加载：获取用户时不立即加载订单列表，只有访问orders时才查询数据库</span></span><br><span class="line">    <span class="meta">@OneToMany(mappedBy = &quot;user&quot;, fetch = FetchType.LAZY)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Order&gt; orders;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 急加载：获取用户时立即加载用户详情</span></span><br><span class="line">    <span class="meta">@OneToOne(fetch = FetchType.EAGER)</span></span><br><span class="line">    <span class="keyword">private</span> UserProfile profile;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 默认的获取策略：</span></span><br><span class="line">    <span class="comment">// @OneToOne, @ManyToOne: 默认是EAGER</span></span><br><span class="line">    <span class="comment">// @OneToMany, @ManyToMany: 默认是LAZY</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 解决N+1查询问题的方法</span></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserRepository</span> <span class="keyword">extends</span> <span class="title class_">JpaRepository</span>&lt;User, Long&gt; &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 使用JOIN FETCH避免N+1问题</span></span><br><span class="line">    <span class="meta">@Query(&quot;SELECT u FROM User u JOIN FETCH u.orders WHERE u.id = :id&quot;)</span></span><br><span class="line">    Optional&lt;User&gt; <span class="title function_">findByIdWithOrders</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span> Long id)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 使用@EntityGraph</span></span><br><span class="line">    <span class="meta">@EntityGraph(attributePaths = &#123;&quot;orders&quot;, &quot;profile&quot;&#125;)</span></span><br><span class="line">    <span class="meta">@Query(&quot;SELECT u FROM User u WHERE u.id = :id&quot;)</span></span><br><span class="line">    Optional&lt;User&gt; <span class="title function_">findByIdWithOrdersAndProfile</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span> Long id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="完整的JPA实体示例"><a href="#完整的JPA实体示例" class="headerlink" title="完整的JPA实体示例"></a>完整的JPA实体示例</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 完整的JPA实体示例：电商系统的订单实体</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;orders&quot;)</span></span><br><span class="line"><span class="meta">@EntityListeners(AuditingEntityListener.class)</span> <span class="comment">// 启用审计功能</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Order</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Column(name = &quot;order_number&quot;, nullable = false, unique = true, length = 50)</span></span><br><span class="line">    <span class="keyword">private</span> String orderNumber;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Column(name = &quot;total_amount&quot;, nullable = false, precision = 10, scale = 2)</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal totalAmount;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Enumerated(EnumType.STRING)</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;status&quot;, nullable = false)</span></span><br><span class="line">    <span class="keyword">private</span> OrderStatus status;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ManyToOne(fetch = FetchType.LAZY)</span></span><br><span class="line">    <span class="meta">@JoinColumn(name = &quot;user_id&quot;, nullable = false)</span></span><br><span class="line">    <span class="keyword">private</span> User user;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@OneToMany(mappedBy = &quot;order&quot;, cascade = CascadeType.ALL, fetch = FetchType.LAZY)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;OrderItem&gt; orderItems = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Embedded</span></span><br><span class="line">    <span class="keyword">private</span> Address shippingAddress;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 审计字段</span></span><br><span class="line">    <span class="meta">@CreatedDate</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;created_at&quot;, nullable = false, updatable = false)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createdAt;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@LastModifiedDate</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;updated_at&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime updatedAt;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@CreatedBy</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;created_by&quot;, updatable = false)</span></span><br><span class="line">    <span class="keyword">private</span> String createdBy;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@LastModifiedBy</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;updated_by&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String updatedBy;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 生命周期回调方法</span></span><br><span class="line">    <span class="meta">@PrePersist</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (orderNumber == <span class="literal">null</span>) &#123;</span><br><span class="line">            orderNumber = generateOrderNumber();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (status == <span class="literal">null</span>) &#123;</span><br><span class="line">            status = OrderStatus.PENDING;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PreUpdate</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onUpdate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 更新前的逻辑</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">generateOrderNumber</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;ORD&quot;</span> + System.currentTimeMillis();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 便利方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addOrderItem</span><span class="params">(OrderItem item)</span> &#123;</span><br><span class="line">        orderItems.add(item);</span><br><span class="line">        item.setOrder(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">removeOrderItem</span><span class="params">(OrderItem item)</span> &#123;</span><br><span class="line">        orderItems.remove(item);</span><br><span class="line">        item.setOrder(<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 构造器、getter、setter...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 嵌入式值对象</span></span><br><span class="line"><span class="meta">@Embeddable</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Address</span> &#123;</span><br><span class="line">    <span class="meta">@Column(name = &quot;street&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String street;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Column(name = &quot;city&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String city;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Column(name = &quot;state&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String state;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Column(name = &quot;zip_code&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String zipCode;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Column(name = &quot;country&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String country;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 构造器、getter、setter...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 枚举类型</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">OrderStatus</span> &#123;</span><br><span class="line">    PENDING(<span class="string">&quot;待处理&quot;</span>),</span><br><span class="line">    CONFIRMED(<span class="string">&quot;已确认&quot;</span>),</span><br><span class="line">    SHIPPED(<span class="string">&quot;已发货&quot;</span>),</span><br><span class="line">    DELIVERED(<span class="string">&quot;已送达&quot;</span>),</span><br><span class="line">    CANCELLED(<span class="string">&quot;已取消&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String description;</span><br><span class="line">    </span><br><span class="line">    OrderStatus(String description) &#123;</span><br><span class="line">        <span class="built_in">this</span>.description = description;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getDescription</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> description;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-4-Bean-Validation（数据验证）注解详解"><a href="#6-4-Bean-Validation（数据验证）注解详解" class="headerlink" title="6.4 Bean Validation（数据验证）注解详解"></a>6.4 Bean Validation（数据验证）注解详解</h3><p><strong>Bean Validation</strong>是Java的数据验证标准，用于验证Java对象的字段值是否符合预期。Spring Boot默认集成了Hibernate Validator（Bean Validation的实现）。</p>
<h4 id="基础验证注解"><a href="#基础验证注解" class="headerlink" title="基础验证注解"></a>基础验证注解</h4><h5 id="空值检查注解"><a href="#空值检查注解" class="headerlink" title="空值检查注解"></a>空值检查注解</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 数据验证注解示例：用户注册表单</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserRegistrationDto</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@NotNull</span>: 值不能为null</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@NotEmpty</span>: 值不能为null且长度大于0（用于字符串、集合、数组）</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@NotBlank</span>: 值不能为null、空字符串或只包含空白字符（只用于字符串）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NotNull(message = &quot;用户名不能为空&quot;)</span></span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;用户名不能为空白&quot;)</span></span><br><span class="line">    <span class="meta">@Size(min = 3, max = 20, message = &quot;用户名长度必须在3-20个字符之间&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NotEmpty(message = &quot;密码不能为空&quot;)</span></span><br><span class="line">    <span class="meta">@Size(min = 6, max = 50, message = &quot;密码长度必须在6-50个字符之间&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;确认密码不能为空&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String confirmPassword;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NotNull(message = &quot;邮箱不能为空&quot;)</span></span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;邮箱不能为空白&quot;)</span></span><br><span class="line">    <span class="meta">@Email(message = &quot;邮箱格式不正确&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 构造器、getter、setter...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 验证示例</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/auth&quot;)</span></span><br><span class="line"><span class="meta">@Validated</span> <span class="comment">// 启用方法级别的验证</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping(&quot;/register&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;String&gt; <span class="title function_">register</span><span class="params">(<span class="meta">@Valid</span> <span class="meta">@RequestBody</span> UserRegistrationDto dto)</span> &#123;</span><br><span class="line">        <span class="comment">// @Valid 会自动触发验证，如果验证失败会抛出MethodArgumentNotValidException</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 验证通过后的业务逻辑</span></span><br><span class="line">        userService.registerUser(dto);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(<span class="string">&quot;注册成功&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 方法参数验证</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/check-username&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;Boolean&gt; <span class="title function_">checkUsername</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam</span> <span class="meta">@NotBlank</span> <span class="meta">@Size(min = 3, max = 20)</span> String username)</span> &#123;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">available</span> <span class="operator">=</span> userService.isUsernameAvailable(username);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(available);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="数值范围验证注解"><a href="#数值范围验证注解" class="headerlink" title="数值范围验证注解"></a>数值范围验证注解</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProductDto</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;商品名称不能为空&quot;)</span></span><br><span class="line">    <span class="meta">@Size(max = 100, message = &quot;商品名称不能超过100个字符&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 数值验证注解：</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Min</span>: 最小值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Max</span>: 最大值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@DecimalMin</span>: 最小小数值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@DecimalMax</span>: 最大小数值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Positive</span>: 正数（大于0）</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@PositiveOrZero</span>: 正数或0</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Negative</span>: 负数（小于0）</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@NegativeOrZero</span>: 负数或0</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NotNull(message = &quot;价格不能为空&quot;)</span></span><br><span class="line">    <span class="meta">@DecimalMin(value = &quot;0.01&quot;, message = &quot;价格必须大于0.01&quot;)</span></span><br><span class="line">    <span class="meta">@DecimalMax(value = &quot;999999.99&quot;, message = &quot;价格不能超过999999.99&quot;)</span></span><br><span class="line">    <span class="meta">@Digits(integer = 6, fraction = 2, message = &quot;价格格式不正确，最多6位整数和2位小数&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal price;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Min(value = 0, message = &quot;库存数量不能为负数&quot;)</span></span><br><span class="line">    <span class="meta">@Max(value = 10000, message = &quot;库存数量不能超过10000&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer stockQuantity;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Positive(message = &quot;重量必须为正数&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Double weight;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PositiveOrZero(message = &quot;折扣不能为负数&quot;)</span></span><br><span class="line">    <span class="meta">@DecimalMax(value = &quot;1.0&quot;, message = &quot;折扣不能超过1.0&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal discount;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 构造器、getter、setter...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="字符串格式验证注解"><a href="#字符串格式验证注解" class="headerlink" title="字符串格式验证注解"></a>字符串格式验证注解</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ContactDto</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 字符串格式验证注解：</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Email</span>: 邮箱格式</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Pattern</span>: 正则表达式匹配</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Size</span>: 字符串长度</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;姓名不能为空&quot;)</span></span><br><span class="line">    <span class="meta">@Size(min = 2, max = 50, message = &quot;姓名长度必须在2-50个字符之间&quot;)</span></span><br><span class="line">    <span class="meta">@Pattern(regexp = &quot;^[\\u4e00-\\u9fa5a-zA-Z\\s]+$&quot;, message = &quot;姓名只能包含中文、英文字母和空格&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Email(message = &quot;邮箱格式不正确&quot;)</span></span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;邮箱不能为空&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 中国手机号验证</span></span><br><span class="line">    <span class="meta">@Pattern(regexp = &quot;^1[3-9]\\d&#123;9&#125;$&quot;, message = &quot;手机号格式不正确&quot;)</span></span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;手机号不能为空&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String phoneNumber;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 身份证号验证</span></span><br><span class="line">    <span class="meta">@Pattern(regexp = &quot;^[1-9]\\d&#123;5&#125;(18|19|20)\\d&#123;2&#125;((0[1-9])|(1[0-2]))(([0-2][1-9])|10|20|30|31)\\d&#123;3&#125;[0-9Xx]$&quot;, </span></span><br><span class="line"><span class="meta">             message = &quot;身份证号格式不正确&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String idCard;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// URL验证</span></span><br><span class="line">    <span class="meta">@Pattern(regexp = &quot;^https?://.+&quot;, message = &quot;网址格式不正确&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String website;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 邮政编码验证</span></span><br><span class="line">    <span class="meta">@Pattern(regexp = &quot;^\\d&#123;6&#125;$&quot;, message = &quot;邮政编码必须是6位数字&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String zipCode;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 构造器、getter、setter...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="时间日期验证注解"><a href="#时间日期验证注解" class="headerlink" title="时间日期验证注解"></a>时间日期验证注解</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EventDto</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;活动名称不能为空&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 时间验证注解：</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Past</span>: 过去的时间</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@PastOrPresent</span>: 过去或现在的时间</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Future</span>: 未来的时间</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@FutureOrPresent</span>: 未来或现在的时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NotNull(message = &quot;生日不能为空&quot;)</span></span><br><span class="line">    <span class="meta">@Past(message = &quot;生日必须是过去的日期&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDate birthday;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NotNull(message = &quot;开始时间不能为空&quot;)</span></span><br><span class="line">    <span class="meta">@FutureOrPresent(message = &quot;开始时间不能早于当前时间&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime startTime;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NotNull(message = &quot;结束时间不能为空&quot;)</span></span><br><span class="line">    <span class="meta">@Future(message = &quot;结束时间必须是未来的时间&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime endTime;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PastOrPresent(message = &quot;创建时间不能是未来时间&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createdAt;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 构造器、getter、setter...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="高级验证功能"><a href="#高级验证功能" class="headerlink" title="高级验证功能"></a>高级验证功能</h4><h5 id="自定义验证注解"><a href="#自定义验证注解" class="headerlink" title="自定义验证注解"></a>自定义验证注解</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义验证注解：密码强度验证</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Target(&#123;ElementType.FIELD, ElementType.PARAMETER&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Constraint(validatedBy = PasswordValidator.class)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> ValidPassword &#123;</span><br><span class="line">    String <span class="title function_">message</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;密码强度不够：至少8位，包含大小写字母、数字和特殊字符&quot;</span>;</span><br><span class="line">    Class&lt;?&gt;[] groups() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">    Class&lt;? <span class="keyword">extends</span> <span class="title class_">Payload</span>&gt;[] payload() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 验证器实现</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PasswordValidator</span> <span class="keyword">implements</span> <span class="title class_">ConstraintValidator</span>&lt;ValidPassword, String&gt; &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PASSWORD_PATTERN</span> <span class="operator">=</span> </span><br><span class="line">        <span class="string">&quot;^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[@$!%*?&amp;])[A-Za-z\\d@$!%*?&amp;]&#123;8,&#125;$&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Pattern pattern;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initialize</span><span class="params">(ValidPassword constraintAnnotation)</span> &#123;</span><br><span class="line">        pattern = Pattern.compile(PASSWORD_PATTERN);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isValid</span><span class="params">(String password, ConstraintValidatorContext context)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (password == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="type">Matcher</span> <span class="variable">matcher</span> <span class="operator">=</span> pattern.matcher(password);</span><br><span class="line">        <span class="keyword">if</span> (!matcher.matches()) &#123;</span><br><span class="line">            <span class="comment">// 自定义错误消息</span></span><br><span class="line">            context.disableDefaultConstraintViolation();</span><br><span class="line">            </span><br><span class="line">            List&lt;String&gt; errors = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            <span class="keyword">if</span> (password.length() &lt; <span class="number">8</span>) &#123;</span><br><span class="line">                errors.add(<span class="string">&quot;密码长度至少8位&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (!password.matches(<span class="string">&quot;.*[a-z].*&quot;</span>)) &#123;</span><br><span class="line">                errors.add(<span class="string">&quot;必须包含小写字母&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (!password.matches(<span class="string">&quot;.*[A-Z].*&quot;</span>)) &#123;</span><br><span class="line">                errors.add(<span class="string">&quot;必须包含大写字母&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (!password.matches(<span class="string">&quot;.*\\d.*&quot;</span>)) &#123;</span><br><span class="line">                errors.add(<span class="string">&quot;必须包含数字&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (!password.matches(<span class="string">&quot;.*[@$!%*?&amp;].*&quot;</span>)) &#123;</span><br><span class="line">                errors.add(<span class="string">&quot;必须包含特殊字符(@$!%*?&amp;)&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="type">String</span> <span class="variable">errorMessage</span> <span class="operator">=</span> <span class="string">&quot;密码要求：&quot;</span> + String.join(<span class="string">&quot;、&quot;</span>, errors);</span><br><span class="line">            context.buildConstraintViolationWithTemplate(errorMessage)</span><br><span class="line">                   .addConstraintViolation();</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用自定义验证注解</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChangePasswordDto</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;当前密码不能为空&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String currentPassword;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ValidPassword</span> <span class="comment">// 使用自定义验证注解</span></span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;新密码不能为空&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String newPassword;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;确认密码不能为空&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String confirmPassword;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 构造器、getter、setter...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="类级别验证（跨字段验证）"><a href="#类级别验证（跨字段验证）" class="headerlink" title="类级别验证（跨字段验证）"></a>类级别验证（跨字段验证）</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 类级别验证注解：确保两个字段相等</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Constraint(validatedBy = FieldMatchValidator.class)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> FieldMatch &#123;</span><br><span class="line">    String <span class="title function_">message</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;字段不匹配&quot;</span>;</span><br><span class="line">    String <span class="title function_">first</span><span class="params">()</span>;</span><br><span class="line">    String <span class="title function_">second</span><span class="params">()</span>;</span><br><span class="line">    Class&lt;?&gt;[] groups() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">    Class&lt;? <span class="keyword">extends</span> <span class="title class_">Payload</span>&gt;[] payload() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 验证器实现</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FieldMatchValidator</span> <span class="keyword">implements</span> <span class="title class_">ConstraintValidator</span>&lt;FieldMatch, Object&gt; &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String firstFieldName;</span><br><span class="line">    <span class="keyword">private</span> String secondFieldName;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initialize</span><span class="params">(FieldMatch constraintAnnotation)</span> &#123;</span><br><span class="line">        firstFieldName = constraintAnnotation.first();</span><br><span class="line">        secondFieldName = constraintAnnotation.second();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isValid</span><span class="params">(Object value, ConstraintValidatorContext context)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Object</span> <span class="variable">firstObj</span> <span class="operator">=</span> getFieldValue(value, firstFieldName);</span><br><span class="line">            <span class="type">Object</span> <span class="variable">secondObj</span> <span class="operator">=</span> getFieldValue(value, secondFieldName);</span><br><span class="line">            </span><br><span class="line">            <span class="type">boolean</span> <span class="variable">valid</span> <span class="operator">=</span> Objects.equals(firstObj, secondObj);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (!valid) &#123;</span><br><span class="line">                context.disableDefaultConstraintViolation();</span><br><span class="line">                context.buildConstraintViolationWithTemplate(</span><br><span class="line">                    String.format(<span class="string">&quot;%s和%s必须相同&quot;</span>, firstFieldName, secondFieldName))</span><br><span class="line">                       .addPropertyNode(secondFieldName)</span><br><span class="line">                       .addConstraintViolation();</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> valid;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Object <span class="title function_">getFieldValue</span><span class="params">(Object object, String fieldName)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        Class&lt;?&gt; clazz = object.getClass();</span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> clazz.getDeclaredField(fieldName);</span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">return</span> field.get(object);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用类级别验证</span></span><br><span class="line"><span class="meta">@FieldMatch(first = &quot;password&quot;, second = &quot;confirmPassword&quot;, message = &quot;密码和确认密码必须相同&quot;)</span></span><br><span class="line"><span class="meta">@FieldMatch(first = &quot;email&quot;, second = &quot;confirmEmail&quot;, message = &quot;邮箱和确认邮箱必须相同&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserRegistrationDto</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;用户名不能为空&quot;)</span></span><br><span class="line">    <span class="meta">@Size(min = 3, max = 20, message = &quot;用户名长度必须在3-20个字符之间&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ValidPassword</span></span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;密码不能为空&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;确认密码不能为空&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String confirmPassword;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Email(message = &quot;邮箱格式不正确&quot;)</span></span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;邮箱不能为空&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;确认邮箱不能为空&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String confirmEmail;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 构造器、getter、setter...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="验证组（Validation-Groups）"><a href="#验证组（Validation-Groups）" class="headerlink" title="验证组（Validation Groups）"></a>验证组（Validation Groups）</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 验证组：在不同场景下应用不同的验证规则</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义验证组接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CreateGroup</span> &#123;&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UpdateGroup</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDto</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ID只在更新时需要</span></span><br><span class="line">    <span class="meta">@NotNull(groups = UpdateGroup.class, message = &quot;更新时ID不能为空&quot;)</span></span><br><span class="line">    <span class="meta">@Null(groups = CreateGroup.class, message = &quot;创建时ID必须为空&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 用户名在创建和更新时都需要验证</span></span><br><span class="line">    <span class="meta">@NotBlank(groups = &#123;CreateGroup.class, UpdateGroup.class&#125;, message = &quot;用户名不能为空&quot;)</span></span><br><span class="line">    <span class="meta">@Size(min = 3, max = 20, groups = &#123;CreateGroup.class, UpdateGroup.class&#125;, </span></span><br><span class="line"><span class="meta">          message = &quot;用户名长度必须在3-20个字符之间&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 密码只在创建时需要</span></span><br><span class="line">    <span class="meta">@NotBlank(groups = CreateGroup.class, message = &quot;创建时密码不能为空&quot;)</span></span><br><span class="line">    <span class="meta">@ValidPassword(groups = CreateGroup.class)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 邮箱在创建和更新时都需要验证</span></span><br><span class="line">    <span class="meta">@Email(groups = &#123;CreateGroup.class, UpdateGroup.class&#125;, message = &quot;邮箱格式不正确&quot;)</span></span><br><span class="line">    <span class="meta">@NotBlank(groups = &#123;CreateGroup.class, UpdateGroup.class&#125;, message = &quot;邮箱不能为空&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 构造器、getter、setter...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在控制器中使用验证组</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/users&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;User&gt; <span class="title function_">createUser</span><span class="params">(<span class="meta">@Validated(CreateGroup.class)</span> <span class="meta">@RequestBody</span> UserDto dto)</span> &#123;</span><br><span class="line">        <span class="comment">// 只验证CreateGroup组的注解</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.createUser(dto);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.status(HttpStatus.CREATED).body(user);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PutMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;User&gt; <span class="title function_">updateUser</span><span class="params">(<span class="meta">@PathVariable</span> Long id, </span></span><br><span class="line"><span class="params">                                         <span class="meta">@Validated(UpdateGroup.class)</span> <span class="meta">@RequestBody</span> UserDto dto)</span> &#123;</span><br><span class="line">        <span class="comment">// 只验证UpdateGroup组的注解</span></span><br><span class="line">        dto.setId(id);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.updateUser(dto);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="全局异常处理"><a href="#全局异常处理" class="headerlink" title="全局异常处理"></a>全局异常处理</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 全局异常处理：统一处理验证错误</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 处理<span class="doctag">@Valid</span>验证失败的异常（请求体验证）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(MethodArgumentNotValidException.class)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;ValidationErrorResponse&gt; <span class="title function_">handleValidationException</span><span class="params">(</span></span><br><span class="line"><span class="params">            MethodArgumentNotValidException ex)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="type">ValidationErrorResponse</span> <span class="variable">errorResponse</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ValidationErrorResponse</span>();</span><br><span class="line">        errorResponse.setMessage(<span class="string">&quot;请求参数验证失败&quot;</span>);</span><br><span class="line">        errorResponse.setTimestamp(LocalDateTime.now());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 收集所有验证错误</span></span><br><span class="line">        Map&lt;String, String&gt; errors = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        ex.getBindingResult().getFieldErrors().forEach(error -&gt; &#123;</span><br><span class="line">            errors.put(error.getField(), error.getDefaultMessage());</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 收集类级别验证错误</span></span><br><span class="line">        ex.getBindingResult().getGlobalErrors().forEach(error -&gt; &#123;</span><br><span class="line">            errors.put(error.getObjectName(), error.getDefaultMessage());</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        errorResponse.setErrors(errors);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.badRequest().body(errorResponse);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 处理<span class="doctag">@Validated</span>验证失败的异常（方法参数验证）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(ConstraintViolationException.class)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;ValidationErrorResponse&gt; <span class="title function_">handleConstraintViolationException</span><span class="params">(</span></span><br><span class="line"><span class="params">            ConstraintViolationException ex)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="type">ValidationErrorResponse</span> <span class="variable">errorResponse</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ValidationErrorResponse</span>();</span><br><span class="line">        errorResponse.setMessage(<span class="string">&quot;参数验证失败&quot;</span>);</span><br><span class="line">        errorResponse.setTimestamp(LocalDateTime.now());</span><br><span class="line">        </span><br><span class="line">        Map&lt;String, String&gt; errors = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        ex.getConstraintViolations().forEach(violation -&gt; &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">propertyPath</span> <span class="operator">=</span> violation.getPropertyPath().toString();</span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> violation.getMessage();</span><br><span class="line">            errors.put(propertyPath, message);</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        errorResponse.setErrors(errors);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.badRequest().body(errorResponse);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 验证错误响应类</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ValidationErrorResponse</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line">    <span class="keyword">private</span> LocalDateTime timestamp;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, String&gt; errors;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-5-测试注解详解（JUnit-5-Spring-Boot-Test）"><a href="#6-5-测试注解详解（JUnit-5-Spring-Boot-Test）" class="headerlink" title="6.5 测试注解详解（JUnit 5 + Spring Boot Test）"></a>6.5 测试注解详解（JUnit 5 + Spring Boot Test）</h3><p><strong>JUnit 5</strong>是Java的标准测试框架，<strong>Spring Boot Test</strong>提供了Spring应用的测试支持。</p>
<h4 id="JUnit-5-核心注解"><a href="#JUnit-5-核心注解" class="headerlink" title="JUnit 5 核心注解"></a>JUnit 5 核心注解</h4><h5 id="基础测试注解"><a href="#基础测试注解" class="headerlink" title="基础测试注解"></a>基础测试注解</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * JUnit 5 基础测试示例</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CalculatorTest</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Calculator calculator;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@BeforeAll</span>: 在所有测试方法之前执行一次（必须是static方法）</span></span><br><span class="line"><span class="comment">     * 用途：初始化昂贵的资源，如数据库连接池、文件读取等</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@BeforeAll</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setUpClass</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;初始化测试类资源&quot;</span>);</span><br><span class="line">        <span class="comment">// 例如：初始化数据库连接池</span></span><br><span class="line">        <span class="comment">// DatabasePool.initialize();</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@AfterAll</span>: 在所有测试方法之后执行一次（必须是static方法）</span></span><br><span class="line"><span class="comment">     * 用途：清理昂贵的资源</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@AfterAll</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">tearDownClass</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;清理测试类资源&quot;</span>);</span><br><span class="line">        <span class="comment">// 例如：关闭数据库连接池</span></span><br><span class="line">        <span class="comment">// DatabasePool.close();</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@BeforeEach</span>: 在每个测试方法之前执行</span></span><br><span class="line"><span class="comment">     * 用途：为每个测试创建干净的环境</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@BeforeEach</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setUp</span><span class="params">()</span> &#123;</span><br><span class="line">        calculator = <span class="keyword">new</span> <span class="title class_">Calculator</span>();</span><br><span class="line">        System.out.println(<span class="string">&quot;为测试方法准备Calculator实例&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@AfterEach</span>: 在每个测试方法之后执行</span></span><br><span class="line"><span class="comment">     * 用途：清理每个测试产生的副作用</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@AfterEach</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">tearDown</span><span class="params">()</span> &#123;</span><br><span class="line">        calculator = <span class="literal">null</span>;</span><br><span class="line">        System.out.println(<span class="string">&quot;清理Calculator实例&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Test</span>: 标记这是一个测试方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@DisplayName</span>: 为测试提供可读的名称（在测试报告中显示）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;测试两个正数相加&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testAddPositiveNumbers</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// Given（准备）</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">5</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">expected</span> <span class="operator">=</span> <span class="number">8</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// When（执行）</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">actual</span> <span class="operator">=</span> calculator.add(a, b);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Then（验证）</span></span><br><span class="line">        assertEquals(expected, actual, <span class="string">&quot;5 + 3 应该等于 8&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;测试除法操作&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testDivision</span><span class="params">()</span> &#123;</span><br><span class="line">        assertEquals(<span class="number">2.0</span>, calculator.divide(<span class="number">10</span>, <span class="number">5</span>), <span class="number">0.001</span>, <span class="string">&quot;10 / 5 应该等于 2.0&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Test</span>注解的异常测试</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;测试除零异常&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testDivisionByZero</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 验证是否抛出预期的异常</span></span><br><span class="line">        <span class="type">ArithmeticException</span> <span class="variable">exception</span> <span class="operator">=</span> assertThrows(</span><br><span class="line">            ArithmeticException.class, </span><br><span class="line">            () -&gt; calculator.divide(<span class="number">10</span>, <span class="number">0</span>),</span><br><span class="line">            <span class="string">&quot;除零应该抛出ArithmeticException&quot;</span></span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 验证异常消息</span></span><br><span class="line">        assertEquals(<span class="string">&quot;/ by zero&quot;</span>, exception.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Disabled</span>: 禁用测试（类似于JUnit 4的<span class="doctag">@Ignore</span>）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@Disabled(&quot;暂时禁用，等待修复bug #123&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testComplexCalculation</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 这个测试不会执行</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="参数化测试注解"><a href="#参数化测试注解" class="headerlink" title="参数化测试注解"></a>参数化测试注解</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 参数化测试：使用不同的参数运行同一个测试</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ParameterizedTestExample</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@ParameterizedTest</span>: 参数化测试</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@ValueSource</span>: 提供简单类型的参数值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ParameterizedTest</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;测试字符串长度验证&quot;)</span></span><br><span class="line">    <span class="meta">@ValueSource(strings = &#123;&quot;&quot;, &quot;   &quot;, &quot;test&quot;, &quot;hello world&quot;&#125;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testStringLength</span><span class="params">(String input)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (input.trim().isEmpty()) &#123;</span><br><span class="line">            assertTrue(input.trim().length() == <span class="number">0</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            assertTrue(input.length() &gt; <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ParameterizedTest</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;测试数字是否为偶数&quot;)</span></span><br><span class="line">    <span class="meta">@ValueSource(ints = &#123;2, 4, 6, 8, 10&#125;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testEvenNumbers</span><span class="params">(<span class="type">int</span> number)</span> &#123;</span><br><span class="line">        assertTrue(number % <span class="number">2</span> == <span class="number">0</span>, number + <span class="string">&quot; 应该是偶数&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@CsvSource</span>: 提供CSV格式的参数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ParameterizedTest</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;测试加法运算&quot;)</span></span><br><span class="line">    <span class="meta">@CsvSource(&#123;</span></span><br><span class="line"><span class="meta">        &quot;1, 2, 3&quot;,</span></span><br><span class="line"><span class="meta">        &quot;5, 7, 12&quot;, </span></span><br><span class="line"><span class="meta">        &quot;-2, 3, 1&quot;,</span></span><br><span class="line"><span class="meta">        &quot;0, 0, 0&quot;</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testAddition</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span> expected)</span> &#123;</span><br><span class="line">        <span class="type">Calculator</span> <span class="variable">calculator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Calculator</span>();</span><br><span class="line">        assertEquals(expected, calculator.add(a, b));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@CsvFileSource</span>: 从CSV文件读取参数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ParameterizedTest</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;从文件测试用户数据&quot;)</span></span><br><span class="line">    <span class="meta">@CsvFileSource(resources = &quot;/test-users.csv&quot;, numLinesToSkip = 1)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testUserValidation</span><span class="params">(String username, String email, <span class="type">boolean</span> expectedValid)</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(username, email);</span><br><span class="line">        assertEquals(expectedValid, UserValidator.isValid(user));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@MethodSource</span>: 使用方法提供参数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ParameterizedTest</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;测试密码强度&quot;)</span></span><br><span class="line">    <span class="meta">@MethodSource(&quot;providePasswordTestCases&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testPasswordStrength</span><span class="params">(String password, <span class="type">boolean</span> expectedStrong)</span> &#123;</span><br><span class="line">        assertEquals(expectedStrong, PasswordValidator.isStrong(password));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 提供测试参数的静态方法</span></span><br><span class="line">    <span class="keyword">static</span> Stream&lt;Arguments&gt; <span class="title function_">providePasswordTestCases</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Stream.of(</span><br><span class="line">            Arguments.of(<span class="string">&quot;123456&quot;</span>, <span class="literal">false</span>),</span><br><span class="line">            Arguments.of(<span class="string">&quot;Password123!&quot;</span>, <span class="literal">true</span>),</span><br><span class="line">            Arguments.of(<span class="string">&quot;weakpass&quot;</span>, <span class="literal">false</span>),</span><br><span class="line">            Arguments.of(<span class="string">&quot;Strong@Pass123&quot;</span>, <span class="literal">true</span>)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@EnumSource</span>: 使用枚举值作为参数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ParameterizedTest</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;测试用户状态&quot;)</span></span><br><span class="line">    <span class="meta">@EnumSource(UserStatus.class)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testUserStatus</span><span class="params">(UserStatus status)</span> &#123;</span><br><span class="line">        assertNotNull(status);</span><br><span class="line">        assertNotNull(status.getDescription());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@ArgumentsSource</span>: 使用自定义参数提供者</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ParameterizedTest</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;测试自定义参数&quot;)</span></span><br><span class="line">    <span class="meta">@ArgumentsSource(CustomArgumentsProvider.class)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testWithCustomProvider</span><span class="params">(String input, <span class="type">int</span> expectedLength)</span> &#123;</span><br><span class="line">        assertEquals(expectedLength, input.length());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自定义参数提供者</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CustomArgumentsProvider</span> <span class="keyword">implements</span> <span class="title class_">ArgumentsProvider</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Stream&lt;? <span class="keyword">extends</span> <span class="title class_">Arguments</span>&gt; provideArguments(ExtensionContext context) &#123;</span><br><span class="line">        <span class="keyword">return</span> Stream.of(</span><br><span class="line">            Arguments.of(<span class="string">&quot;hello&quot;</span>, <span class="number">5</span>),</span><br><span class="line">            Arguments.of(<span class="string">&quot;world&quot;</span>, <span class="number">5</span>),</span><br><span class="line">            Arguments.of(<span class="string">&quot;test&quot;</span>, <span class="number">4</span>)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Spring-Boot-测试注解"><a href="#Spring-Boot-测试注解" class="headerlink" title="Spring Boot 测试注解"></a>Spring Boot 测试注解</h4><h5 id="完整应用上下文测试"><a href="#完整应用上下文测试" class="headerlink" title="完整应用上下文测试"></a>完整应用上下文测试</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@SpringBootTest</span>: 加载完整的Spring应用上下文</span></span><br><span class="line"><span class="comment"> * 用途：集成测试，测试整个应用的交互</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootTest(</span></span><br><span class="line"><span class="meta">    webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT, // 随机端口启动Web服务器</span></span><br><span class="line"><span class="meta">    properties = &#123;&quot;spring.profiles.active=test&quot;&#125; // 激活test配置文件</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="meta">@TestPropertySource(locations = &quot;classpath:application-test.properties&quot;)</span> <span class="comment">// 额外的测试配置</span></span><br><span class="line"><span class="meta">@DirtiesContext(classMode = DirtiesContext.ClassMode.AFTER_EACH_TEST_METHOD)</span> <span class="comment">// 每个测试后重建上下文</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserServiceIntegrationTest</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserRepository userRepository;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> TestRestTemplate restTemplate; <span class="comment">// 用于HTTP请求测试</span></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@LocalServerPort</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> port; <span class="comment">// 获取随机分配的端口号</span></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;集成测试：创建用户的完整流程&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testCreateUserIntegration</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// Given</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> <span class="string">&quot;testuser&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">email</span> <span class="operator">=</span> <span class="string">&quot;test@example.com&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// When</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.createUser(username, email);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Then</span></span><br><span class="line">        assertNotNull(user.getId());</span><br><span class="line">        assertEquals(username, user.getUsername());</span><br><span class="line">        assertEquals(email, user.getEmail());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 验证数据确实保存到数据库</span></span><br><span class="line">        Optional&lt;User&gt; savedUser = userRepository.findById(user.getId());</span><br><span class="line">        assertTrue(savedUser.isPresent());</span><br><span class="line">        assertEquals(username, savedUser.get().getUsername());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;HTTP接口集成测试&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testUserApiEndpoint</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// Given</span></span><br><span class="line">        <span class="type">CreateUserRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CreateUserRequest</span>(<span class="string">&quot;apiuser&quot;</span>, <span class="string">&quot;api@example.com&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// When</span></span><br><span class="line">        ResponseEntity&lt;User&gt; response = restTemplate.postForEntity(</span><br><span class="line">            <span class="string">&quot;http://localhost:&quot;</span> + port + <span class="string">&quot;/api/users&quot;</span>,</span><br><span class="line">            request,</span><br><span class="line">            User.class</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Then</span></span><br><span class="line">        assertEquals(HttpStatus.CREATED, response.getStatusCode());</span><br><span class="line">        assertNotNull(response.getBody());</span><br><span class="line">        assertEquals(<span class="string">&quot;apiuser&quot;</span>, response.getBody().getUsername());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Web层测试"><a href="#Web层测试" class="headerlink" title="Web层测试"></a>Web层测试</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@WebMvcTest</span>: 只加载Web层组件（Controller、Filter、WebMvcConfigurer等）</span></span><br><span class="line"><span class="comment"> * 优点：启动速度快，只测试Web层逻辑</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebMvcTest(UserController.class)</span> <span class="comment">// 只加载UserController</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserControllerTest</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MockMvc mockMvc; <span class="comment">// 模拟HTTP请求</span></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@MockBean</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService; <span class="comment">// 模拟Service层</span></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ObjectMapper objectMapper; <span class="comment">// JSON序列化工具</span></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;测试获取用户API - 成功案例&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testGetUser_Success</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// Given</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line">        <span class="type">User</span> <span class="variable">mockUser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;testuser&quot;</span>, <span class="string">&quot;test@example.com&quot;</span>);</span><br><span class="line">        mockUser.setId(userId);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">when</span>(userService.findById(userId)).thenReturn(mockUser);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// When &amp; Then</span></span><br><span class="line">        mockMvc.perform(get(<span class="string">&quot;/api/users/&#123;id&#125;&quot;</span>, userId)</span><br><span class="line">                .contentType(MediaType.APPLICATION_JSON))</span><br><span class="line">                .andExpect(status().isOk())</span><br><span class="line">                .andExpect(jsonPath(<span class="string">&quot;$.id&quot;</span>).value(userId))</span><br><span class="line">                .andExpect(jsonPath(<span class="string">&quot;$.username&quot;</span>).value(<span class="string">&quot;testuser&quot;</span>))</span><br><span class="line">                .andExpect(jsonPath(<span class="string">&quot;$.email&quot;</span>).value(<span class="string">&quot;test@example.com&quot;</span>))</span><br><span class="line">                .andDo(print()); <span class="comment">// 打印请求和响应详情</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 验证Service方法被调用</span></span><br><span class="line">        verify(userService, times(<span class="number">1</span>)).findById(userId);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;测试获取用户API - 用户不存在&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testGetUser_NotFound</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// Given</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> <span class="number">999L</span>;</span><br><span class="line">        <span class="keyword">when</span>(userService.findById(userId)).thenThrow(<span class="keyword">new</span> <span class="title class_">UserNotFoundException</span>(<span class="string">&quot;用户不存在&quot;</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// When &amp; Then</span></span><br><span class="line">        mockMvc.perform(get(<span class="string">&quot;/api/users/&#123;id&#125;&quot;</span>, userId)</span><br><span class="line">                .contentType(MediaType.APPLICATION_JSON))</span><br><span class="line">                .andExpect(status().isNotFound());</span><br><span class="line">        </span><br><span class="line">        verify(userService, times(<span class="number">1</span>)).findById(userId);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;测试创建用户API - 成功案例&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testCreateUser_Success</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// Given</span></span><br><span class="line">        <span class="type">CreateUserRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CreateUserRequest</span>(<span class="string">&quot;newuser&quot;</span>, <span class="string">&quot;new@example.com&quot;</span>);</span><br><span class="line">        <span class="type">User</span> <span class="variable">createdUser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;newuser&quot;</span>, <span class="string">&quot;new@example.com&quot;</span>);</span><br><span class="line">        createdUser.setId(<span class="number">1L</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">when</span>(userService.createUser(anyString(), anyString())).thenReturn(createdUser);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// When &amp; Then</span></span><br><span class="line">        mockMvc.perform(post(<span class="string">&quot;/api/users&quot;</span>)</span><br><span class="line">                .contentType(MediaType.APPLICATION_JSON)</span><br><span class="line">                .content(objectMapper.writeValueAsString(request)))</span><br><span class="line">                .andExpect(status().isCreated())</span><br><span class="line">                .andExpect(jsonPath(<span class="string">&quot;$.id&quot;</span>).exists())</span><br><span class="line">                .andExpect(jsonPath(<span class="string">&quot;$.username&quot;</span>).value(<span class="string">&quot;newuser&quot;</span>))</span><br><span class="line">                .andExpect(jsonPath(<span class="string">&quot;$.email&quot;</span>).value(<span class="string">&quot;new@example.com&quot;</span>));</span><br><span class="line">        </span><br><span class="line">        verify(userService, times(<span class="number">1</span>)).createUser(<span class="string">&quot;newuser&quot;</span>, <span class="string">&quot;new@example.com&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;测试创建用户API - 验证失败&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testCreateUser_ValidationError</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// Given: 无效的请求数据</span></span><br><span class="line">        <span class="type">CreateUserRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CreateUserRequest</span>(<span class="string">&quot;&quot;</span>, <span class="string">&quot;invalid-email&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// When &amp; Then</span></span><br><span class="line">        mockMvc.perform(post(<span class="string">&quot;/api/users&quot;</span>)</span><br><span class="line">                .contentType(MediaType.APPLICATION_JSON)</span><br><span class="line">                .content(objectMapper.writeValueAsString(request)))</span><br><span class="line">                .andExpect(status().isBadRequest())</span><br><span class="line">                .andExpect(jsonPath(<span class="string">&quot;$.errors&quot;</span>).exists())</span><br><span class="line">                .andExpect(jsonPath(<span class="string">&quot;$.errors.username&quot;</span>).exists())</span><br><span class="line">                .andExpect(jsonPath(<span class="string">&quot;$.errors.email&quot;</span>).exists());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 验证Service方法没有被调用</span></span><br><span class="line">        verify(userService, never()).createUser(anyString(), anyString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="数据层测试"><a href="#数据层测试" class="headerlink" title="数据层测试"></a>数据层测试</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@DataJpaTest</span>: 只加载JPA相关组件</span></span><br><span class="line"><span class="comment"> * 特点：使用内存数据库，事务自动回滚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@DataJpaTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserRepositoryTest</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> TestEntityManager entityManager; <span class="comment">// 用于测试的EntityManager</span></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserRepository userRepository;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;测试根据用户名查找用户&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testFindByUsername</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// Given</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;testuser&quot;</span>, <span class="string">&quot;test@example.com&quot;</span>);</span><br><span class="line">        entityManager.persistAndFlush(user); <span class="comment">// 立即保存到数据库</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// When</span></span><br><span class="line">        Optional&lt;User&gt; found = userRepository.findByUsername(<span class="string">&quot;testuser&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Then</span></span><br><span class="line">        assertTrue(found.isPresent());</span><br><span class="line">        assertEquals(<span class="string">&quot;testuser&quot;</span>, found.get().getUsername());</span><br><span class="line">        assertEquals(<span class="string">&quot;test@example.com&quot;</span>, found.get().getEmail());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;测试根据邮箱查找用户&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testFindByEmail</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// Given</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;user1&quot;</span>, <span class="string">&quot;user1@example.com&quot;</span>);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;user2&quot;</span>, <span class="string">&quot;user2@example.com&quot;</span>);</span><br><span class="line">        entityManager.persist(user1);</span><br><span class="line">        entityManager.persist(user2);</span><br><span class="line">        entityManager.flush();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// When</span></span><br><span class="line">        Optional&lt;User&gt; found = userRepository.findByEmail(<span class="string">&quot;user1@example.com&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Then</span></span><br><span class="line">        assertTrue(found.isPresent());</span><br><span class="line">        assertEquals(<span class="string">&quot;user1&quot;</span>, found.get().getUsername());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;测试用户名是否存在&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testExistsByUsername</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// Given</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;existinguser&quot;</span>, <span class="string">&quot;existing@example.com&quot;</span>);</span><br><span class="line">        entityManager.persistAndFlush(user);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// When &amp; Then</span></span><br><span class="line">        assertTrue(userRepository.existsByUsername(<span class="string">&quot;existinguser&quot;</span>));</span><br><span class="line">        assertFalse(userRepository.existsByUsername(<span class="string">&quot;nonexistentuser&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;测试自定义查询方法&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testFindActiveUsers</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// Given</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">activeUser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;activeuser&quot;</span>, <span class="string">&quot;active@example.com&quot;</span>);</span><br><span class="line">        activeUser.setStatus(UserStatus.ACTIVE);</span><br><span class="line">        </span><br><span class="line">        <span class="type">User</span> <span class="variable">inactiveUser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;inactiveuser&quot;</span>, <span class="string">&quot;inactive@example.com&quot;</span>);</span><br><span class="line">        inactiveUser.setStatus(UserStatus.INACTIVE);</span><br><span class="line">        </span><br><span class="line">        entityManager.persist(activeUser);</span><br><span class="line">        entityManager.persist(inactiveUser);</span><br><span class="line">        entityManager.flush();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// When</span></span><br><span class="line">        List&lt;User&gt; activeUsers = userRepository.findByStatus(UserStatus.ACTIVE);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Then</span></span><br><span class="line">        assertEquals(<span class="number">1</span>, activeUsers.size());</span><br><span class="line">        assertEquals(<span class="string">&quot;activeuser&quot;</span>, activeUsers.get(<span class="number">0</span>).getUsername());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="服务层测试（使用Mock）"><a href="#服务层测试（使用Mock）" class="headerlink" title="服务层测试（使用Mock）"></a>服务层测试（使用Mock）</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 纯单元测试：不加载Spring上下文，使用Mock对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ExtendWith(MockitoExtension.class)</span> <span class="comment">// JUnit 5 + Mockito</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserServiceTest</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Mock</span></span><br><span class="line">    <span class="keyword">private</span> UserRepository userRepository; <span class="comment">// Mock的Repository</span></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Mock</span></span><br><span class="line">    <span class="keyword">private</span> EmailService emailService; <span class="comment">// Mock的邮件服务</span></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Mock</span></span><br><span class="line">    <span class="keyword">private</span> PasswordEncoder passwordEncoder; <span class="comment">// Mock的密码编码器</span></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@InjectMocks</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService; <span class="comment">// 被测试的服务（自动注入Mock对象）</span></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;测试创建用户 - 成功案例&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testCreateUser_Success</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// Given</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> <span class="string">&quot;newuser&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">email</span> <span class="operator">=</span> <span class="string">&quot;new@example.com&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">rawPassword</span> <span class="operator">=</span> <span class="string">&quot;password123&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">encodedPassword</span> <span class="operator">=</span> <span class="string">&quot;encoded_password&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="type">User</span> <span class="variable">savedUser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(username, email);</span><br><span class="line">        savedUser.setId(<span class="number">1L</span>);</span><br><span class="line">        savedUser.setPassword(encodedPassword);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Mock行为设置</span></span><br><span class="line">        <span class="keyword">when</span>(userRepository.existsByUsername(username)).thenReturn(<span class="literal">false</span>);</span><br><span class="line">        <span class="keyword">when</span>(userRepository.existsByEmail(email)).thenReturn(<span class="literal">false</span>);</span><br><span class="line">        <span class="keyword">when</span>(passwordEncoder.encode(rawPassword)).thenReturn(encodedPassword);</span><br><span class="line">        <span class="keyword">when</span>(userRepository.save(any(User.class))).thenReturn(savedUser);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// When</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">result</span> <span class="operator">=</span> userService.createUser(username, email, rawPassword);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Then</span></span><br><span class="line">        assertNotNull(result);</span><br><span class="line">        assertEquals(<span class="number">1L</span>, result.getId());</span><br><span class="line">        assertEquals(username, result.getUsername());</span><br><span class="line">        assertEquals(email, result.getEmail());</span><br><span class="line">        assertEquals(encodedPassword, result.getPassword());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 验证Mock对象的调用</span></span><br><span class="line">        verify(userRepository, times(<span class="number">1</span>)).existsByUsername(username);</span><br><span class="line">        verify(userRepository, times(<span class="number">1</span>)).existsByEmail(email);</span><br><span class="line">        verify(passwordEncoder, times(<span class="number">1</span>)).encode(rawPassword);</span><br><span class="line">        verify(userRepository, times(<span class="number">1</span>)).save(any(User.class));</span><br><span class="line">        verify(emailService, times(<span class="number">1</span>)).sendWelcomeEmail(email, username);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;测试创建用户 - 用户名已存在&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testCreateUser_UsernameExists</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// Given</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> <span class="string">&quot;existinguser&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">email</span> <span class="operator">=</span> <span class="string">&quot;new@example.com&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">when</span>(userRepository.existsByUsername(username)).thenReturn(<span class="literal">true</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// When &amp; Then</span></span><br><span class="line">        <span class="type">DuplicateUsernameException</span> <span class="variable">exception</span> <span class="operator">=</span> assertThrows(</span><br><span class="line">            DuplicateUsernameException.class,</span><br><span class="line">            () -&gt; userService.createUser(username, email, <span class="string">&quot;password&quot;</span>)</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        assertEquals(<span class="string">&quot;用户名已存在: &quot;</span> + username, exception.getMessage());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 验证后续方法没有被调用</span></span><br><span class="line">        verify(userRepository, times(<span class="number">1</span>)).existsByUsername(username);</span><br><span class="line">        verify(userRepository, never()).existsByEmail(anyString());</span><br><span class="line">        verify(userRepository, never()).save(any(User.class));</span><br><span class="line">        verify(emailService, never()).sendWelcomeEmail(anyString(), anyString());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;测试用户登录 - 成功案例&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testAuthenticate_Success</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// Given</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> <span class="string">&quot;testuser&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">rawPassword</span> <span class="operator">=</span> <span class="string">&quot;password123&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">encodedPassword</span> <span class="operator">=</span> <span class="string">&quot;encoded_password&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(username, <span class="string">&quot;test@example.com&quot;</span>);</span><br><span class="line">        user.setPassword(encodedPassword);</span><br><span class="line">        user.setStatus(UserStatus.ACTIVE);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">when</span>(userRepository.findByUsername(username)).thenReturn(Optional.of(user));</span><br><span class="line">        <span class="keyword">when</span>(passwordEncoder.matches(rawPassword, encodedPassword)).thenReturn(<span class="literal">true</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// When</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> userService.authenticate(username, rawPassword);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Then</span></span><br><span class="line">        assertTrue(result);</span><br><span class="line">        </span><br><span class="line">        verify(userRepository, times(<span class="number">1</span>)).findByUsername(username);</span><br><span class="line">        verify(passwordEncoder, times(<span class="number">1</span>)).matches(rawPassword, encodedPassword);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;测试用户登录 - 密码错误&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testAuthenticate_WrongPassword</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// Given</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> <span class="string">&quot;testuser&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">rawPassword</span> <span class="operator">=</span> <span class="string">&quot;wrongpassword&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">encodedPassword</span> <span class="operator">=</span> <span class="string">&quot;encoded_password&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(username, <span class="string">&quot;test@example.com&quot;</span>);</span><br><span class="line">        user.setPassword(encodedPassword);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">when</span>(userRepository.findByUsername(username)).thenReturn(Optional.of(user));</span><br><span class="line">        <span class="keyword">when</span>(passwordEncoder.matches(rawPassword, encodedPassword)).thenReturn(<span class="literal">false</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// When</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> userService.authenticate(username, rawPassword);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Then</span></span><br><span class="line">        assertFalse(result);</span><br><span class="line">        </span><br><span class="line">        verify(userRepository, times(<span class="number">1</span>)).findByUsername(username);</span><br><span class="line">        verify(passwordEncoder, times(<span class="number">1</span>)).matches(rawPassword, encodedPassword);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="7-自定义注解"><a href="#7-自定义注解" class="headerlink" title="7. 自定义注解"></a>7. 自定义注解</h2><h3 id="7-1-创建自定义注解"><a href="#7-1-创建自定义注解" class="headerlink" title="7.1 创建自定义注解"></a>7.1 创建自定义注解</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义注解</span></span><br><span class="line"><span class="meta">@Target(ElementType.METHOD)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> LogExecutionTime &#123;</span><br><span class="line">    String <span class="title function_">value</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">enabled</span><span class="params">()</span> <span class="keyword">default</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用注解</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BusinessService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@LogExecutionTime(&quot;用户查询&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">findUser</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="comment">// 业务逻辑</span></span><br><span class="line">        <span class="keyword">return</span> userRepository.findById(id);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@LogExecutionTime(value = &quot;数据处理&quot;, enabled = false)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processData</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 处理逻辑</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="7-2-注解处理器实现"><a href="#7-2-注解处理器实现" class="headerlink" title="7.2 注解处理器实现"></a>7.2 注解处理器实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogExecutionTimeAspect</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(LogExecutionTimeAspect.class);</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Around(&quot;@annotation(logExecutionTime)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">logExecutionTime</span><span class="params">(ProceedingJoinPoint joinPoint, </span></span><br><span class="line"><span class="params">                                  LogExecutionTime logExecutionTime)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!logExecutionTime.enabled()) &#123;</span><br><span class="line">            <span class="keyword">return</span> joinPoint.proceed();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="type">long</span> <span class="variable">startTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="type">String</span> <span class="variable">operation</span> <span class="operator">=</span> logExecutionTime.value().isEmpty() ? </span><br><span class="line">                          joinPoint.getSignature().getName() : </span><br><span class="line">                          logExecutionTime.value();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> joinPoint.proceed();</span><br><span class="line">            <span class="type">long</span> <span class="variable">endTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">            logger.info(<span class="string">&quot;操作 [&#123;&#125;] 执行时间: &#123;&#125;ms&quot;</span>, operation, endTime - startTime);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            logger.error(<span class="string">&quot;操作 [&#123;&#125;] 执行失败&quot;</span>, operation, e);</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="7-3-通过反射处理注解"><a href="#7-3-通过反射处理注解" class="headerlink" title="7.3 通过反射处理注解"></a>7.3 通过反射处理注解</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AnnotationProcessor</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">processAnnotations</span><span class="params">(Object obj)</span> &#123;</span><br><span class="line">        Class&lt;?&gt; clazz = obj.getClass();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 处理类级别注解</span></span><br><span class="line">        <span class="keyword">if</span> (clazz.isAnnotationPresent(Component.class)) &#123;</span><br><span class="line">            <span class="type">Component</span> <span class="variable">component</span> <span class="operator">=</span> clazz.getAnnotation(Component.class);</span><br><span class="line">            System.out.println(<span class="string">&quot;组件名称: &quot;</span> + component.value());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 处理方法级别注解</span></span><br><span class="line">        Method[] methods = clazz.getDeclaredMethods();</span><br><span class="line">        <span class="keyword">for</span> (Method method : methods) &#123;</span><br><span class="line">            <span class="keyword">if</span> (method.isAnnotationPresent(LogExecutionTime.class)) &#123;</span><br><span class="line">                <span class="type">LogExecutionTime</span> <span class="variable">annotation</span> <span class="operator">=</span> method.getAnnotation(LogExecutionTime.class);</span><br><span class="line">                System.out.println(<span class="string">&quot;方法 &quot;</span> + method.getName() + </span><br><span class="line">                                 <span class="string">&quot; 需要记录执行时间: &quot;</span> + annotation.value());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 处理字段级别注解</span></span><br><span class="line">        Field[] fields = clazz.getDeclaredFields();</span><br><span class="line">        <span class="keyword">for</span> (Field field : fields) &#123;</span><br><span class="line">            <span class="keyword">if</span> (field.isAnnotationPresent(Autowired.class)) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;字段 &quot;</span> + field.getName() + <span class="string">&quot; 需要自动注入&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="8-注解的最佳实践"><a href="#8-注解的最佳实践" class="headerlink" title="8. 注解的最佳实践"></a>8. 注解的最佳实践</h2><h3 id="8-1-设计原则"><a href="#8-1-设计原则" class="headerlink" title="8.1 设计原则"></a>8.1 设计原则</h3><ol>
<li><strong>单一职责</strong>：每个注解只做一件事</li>
<li><strong>命名清晰</strong>：注解名称应该清楚表达其用途</li>
<li><strong>参数合理</strong>：提供合理的默认值，减少使用复杂度</li>
<li><strong>文档完善</strong>：为注解和参数提供详细文档</li>
</ol>
<h3 id="8-2-使用建议"><a href="#8-2-使用建议" class="headerlink" title="8.2 使用建议"></a>8.2 使用建议</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ❌ 不好的设计 - 职责不清</span></span><br><span class="line"><span class="meta">@AllInOne(log = true, validate = true, cache = true, retry = 3)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 好的设计 - 职责分离</span></span><br><span class="line"><span class="meta">@Log</span></span><br><span class="line"><span class="meta">@Validate</span></span><br><span class="line"><span class="meta">@Cacheable</span></span><br><span class="line"><span class="meta">@Retry(times = 3)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">()</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="8-3-性能考虑"><a href="#8-3-性能考虑" class="headerlink" title="8.3 性能考虑"></a>8.3 性能考虑</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 反射操作应该缓存</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AnnotationCache</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;Class&lt;?&gt;, List&lt;Method&gt;&gt; methodCache = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> List&lt;Method&gt; <span class="title function_">getAnnotatedMethods</span><span class="params">(Class&lt;?&gt; clazz, Class&lt;? extends Annotation&gt; annotation)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> methodCache.computeIfAbsent(clazz, k -&gt; &#123;</span><br><span class="line">            <span class="keyword">return</span> Arrays.stream(k.getDeclaredMethods())</span><br><span class="line">                        .filter(m -&gt; m.isAnnotationPresent(annotation))</span><br><span class="line">                        .collect(Collectors.toList());</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="9-常见错误和解决方案"><a href="#9-常见错误和解决方案" class="headerlink" title="9. 常见错误和解决方案"></a>9. 常见错误和解决方案</h2><h3 id="9-1-注解丢失问题"><a href="#9-1-注解丢失问题" class="headerlink" title="9.1 注解丢失问题"></a>9.1 注解丢失问题</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 问题：运行时无法获取注解</span></span><br><span class="line"><span class="meta">@Target(ElementType.METHOD)</span></span><br><span class="line"><span class="comment">// @Retention(RetentionPolicy.RUNTIME)  // 忘记添加</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MyAnnotation &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 解决：正确设置保留策略</span></span><br><span class="line"><span class="meta">@Target(ElementType.METHOD)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MyAnnotation &#123;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="9-2-继承问题"><a href="#9-2-继承问题" class="headerlink" title="9.2 继承问题"></a>9.2 继承问题</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 问题：子类无法继承父类的注解</span></span><br><span class="line"><span class="meta">@Inherited</span>  <span class="comment">// 添加此注解使得注解可以被继承</span></span><br><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Service &#123;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="9-3-重复注解"><a href="#9-3-重复注解" class="headerlink" title="9.3 重复注解"></a>9.3 重复注解</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Java 8+ 支持重复注解</span></span><br><span class="line"><span class="meta">@Repeatable(Schedules.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Schedule &#123;</span><br><span class="line">    String <span class="title function_">time</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Schedules &#123;</span><br><span class="line">    Schedule[] value();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="meta">@Schedule(time = &quot;morning&quot;)</span></span><br><span class="line"><span class="meta">@Schedule(time = &quot;evening&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">task</span><span class="params">()</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="10-学习建议"><a href="#10-学习建议" class="headerlink" title="10. 学习建议"></a>10. 学习建议</h2><h3 id="10-1-循序渐进"><a href="#10-1-循序渐进" class="headerlink" title="10.1 循序渐进"></a>10.1 循序渐进</h3><ol>
<li><strong>理解基础</strong>：先掌握内置注解的使用</li>
<li><strong>框架应用</strong>：学习Spring等框架中注解的使用</li>
<li><strong>自定义注解</strong>：尝试创建自己的注解</li>
<li><strong>深入原理</strong>：了解注解处理器和反射机制</li>
</ol>
<h3 id="10-2-实践项目"><a href="#10-2-实践项目" class="headerlink" title="10.2 实践项目"></a>10.2 实践项目</h3><ul>
<li>创建一个简单的Web项目，使用Spring Boot注解</li>
<li>实现一个日志记录的自定义注解</li>
<li>编写一个数据验证的注解系统</li>
</ul>
<h3 id="10-3-进阶学习"><a href="#10-3-进阶学习" class="headerlink" title="10.3 进阶学习"></a>10.3 进阶学习</h3><ul>
<li>学习APT（Annotation Processing Tool）</li>
<li>了解编译时代码生成</li>
<li>研究主流框架的注解实现原理</li>
</ul>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>Java注解是一个强大的元编程工具，它让代码更加简洁、可读性更强。相比C++的宏系统，Java注解提供了更安全、更强大的元数据机制。掌握注解的使用不仅能让你更好地使用现有框架，还能帮你设计出更优雅的API。</p>
<p>注解是对代码的描述，而不是代码本身。正确理解和使用注解，将大大提升Java编程水平。</p>
<hr>
<p><em>感谢阅读！如果这篇文章对你有帮助，欢迎点赞和分享。</em></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="http://summer-flower.com">forever</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="http://summer-flower.com/2025/08/12/Java%20%E6%B3%A8%E8%A7%A3/">http://summer-flower.com/2025/08/12/Java%20%E6%B3%A8%E8%A7%A3/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/JAVA/">JAVA</a></div><div class="post-share"><div class="social-share" data-image="/photos/avatar.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/08/13/%E7%BD%91%E9%A1%B5%E6%9E%84%E5%BB%BA%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E8%AF%A6%E8%A7%A3/" title="🌐 网页构建基础知识详解"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">🌐 网页构建基础知识详解</div></div><div class="info-2"><div class="info-item-1">🌐 网页构建基础知识体系作为一个前端开发的初学者，了解网页构建的完整体系是非常重要的。本文将从专业角度为你系统地解释整个网页开发的基础知识。 1. 前端三剑客 - 网页的基础构成🏗️ HTML (HyperText Markup Language) 作用：网页的骨架和结构 比喻：就像房子的框架，定义了哪里是门、哪里是窗户 核心概念：  1234567891011&lt;!DOCTYPE html&gt;&lt;html&gt;  &lt;head&gt;    &lt;title&gt;页面标题&lt;/title&gt;  &lt;/head&gt;  &lt;body&gt;    &lt;h1&gt;这是标题&lt;/h1&gt;    &lt;p&gt;这是段落&lt;/p&gt;    &lt;div&gt;这是容器&lt;/div&gt;  &lt;/body&gt;&lt;/html&gt;  常用HTML标签：  &lt;h1&gt; - &lt;h6&gt;：标题 &lt;p&gt;：段落 &lt;div&gt;：容器 &lt;span&gt;：内联元素 &...</div></div></div></a><a class="pagination-related" href="/2025/08/12/%E4%BA%91%E5%8E%9F%E7%94%9F%E7%BB%93%E8%AF%BEproject/" title="云原生结课project"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">云原生结课project</div></div><div class="info-2"><div class="info-item-1">📝 云原生结课project 顺手上传暑课项目  1. 项目组员信息   姓名 学号 个人贡献    黄睿智 231220075 part3 + 文档编写   白子敬 231220077 part1   陈翔宇 231220088 part2    2. 限流功能相关的关键代码和说明2.1 限流系统架构概述本项目采用基于 Bucket4j + Redis 的分布式限流方案，实现了多层次的流量控制机制：  应用层限流：使用 Bucket4j 令牌桶算法 连接层限流：Spring Boot Tomcat 连接池限制 网络层限流：Kubernetes 网络策略和端口转发限制  2.2 核心限流组件限流配置类 (RateLimitConfig.java)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475@Configurationpublic class R...</div></div></div></a></nav><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comments</span></div></div><div class="comment-wrap"><div><div id="giscus-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/photos/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">forever</div><div class="author-info-description">this is forever’s blog , and I plan to share some photos and cs learning stories , wish can help you and make your day .</div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">11</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">15</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">4</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/231220075"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/231220075" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:231220075@smail.nju.edu.cn" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%F0%9F%93%9D-Java-%E6%B3%A8%E8%A7%A3%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97"><span class="toc-number">1.</span> <span class="toc-text">📝 Java 注解完全指南</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E4%BB%80%E4%B9%88%E6%98%AFJava%E6%B3%A8%E8%A7%A3%EF%BC%9F"><span class="toc-number">1.1.</span> <span class="toc-text">1. 什么是Java注解？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E8%A7%A3%E7%9A%84%E6%9C%AC%E8%B4%A8"><span class="toc-number">1.1.1.</span> <span class="toc-text">注解的本质</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-Java%E6%B3%A8%E8%A7%A3-vs-C-%E7%9A%84%E5%AF%B9%E6%AF%94"><span class="toc-number">1.2.</span> <span class="toc-text">2. Java注解 vs C++的对比</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BE%E4%BE%8B%E5%AF%B9%E6%AF%94%EF%BC%9A"><span class="toc-number">1.2.1.</span> <span class="toc-text">举例对比：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E6%B3%A8%E8%A7%A3%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">1.3.</span> <span class="toc-text">3. 注解的工作原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E7%BC%96%E8%AF%91%E6%97%B6%E5%A4%84%E7%90%86"><span class="toc-number">1.3.1.</span> <span class="toc-text">3.1 编译时处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E4%B8%89%E4%B8%AA%E5%A4%84%E7%90%86%E9%98%B6%E6%AE%B5"><span class="toc-number">1.3.2.</span> <span class="toc-text">3.2 三个处理阶段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-%E6%B3%A8%E8%A7%A3%E5%A4%84%E7%90%86%E5%99%A8%EF%BC%88Annotation-Processor%EF%BC%89"><span class="toc-number">1.3.3.</span> <span class="toc-text">3.3 注解处理器（Annotation Processor）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E6%B3%A8%E8%A7%A3%E7%9A%84%E5%88%86%E7%B1%BB"><span class="toc-number">1.4.</span> <span class="toc-text">4. 注解的分类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E6%8C%89%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%88%86%E7%B1%BB"><span class="toc-number">1.4.1.</span> <span class="toc-text">4.1 按生命周期分类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SOURCE%EF%BC%88%E6%BA%90%E7%A0%81%E7%BA%A7%EF%BC%89"><span class="toc-number">1.4.1.1.</span> <span class="toc-text">SOURCE（源码级）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CLASS%EF%BC%88%E5%AD%97%E8%8A%82%E7%A0%81%E7%BA%A7%EF%BC%89"><span class="toc-number">1.4.1.2.</span> <span class="toc-text">CLASS（字节码级）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RUNTIME%EF%BC%88%E8%BF%90%E8%A1%8C%E6%97%B6%E7%BA%A7%EF%BC%89"><span class="toc-number">1.4.1.3.</span> <span class="toc-text">RUNTIME（运行时级）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E6%8C%89%E4%BD%9C%E7%94%A8%E7%9B%AE%E6%A0%87%E5%88%86%E7%B1%BB"><span class="toc-number">1.4.2.</span> <span class="toc-text">4.2 按作用目标分类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E5%B8%B8%E8%A7%81%E5%86%85%E7%BD%AE%E6%B3%A8%E8%A7%A3%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.5.</span> <span class="toc-text">5. 常见内置注解详解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-%E5%9F%BA%E7%A1%80%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.5.1.</span> <span class="toc-text">5.1 基础注解</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Override"><span class="toc-number">1.5.1.1.</span> <span class="toc-text">@Override</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Deprecated"><span class="toc-number">1.5.1.2.</span> <span class="toc-text">@Deprecated</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SuppressWarnings"><span class="toc-number">1.5.1.3.</span> <span class="toc-text">@SuppressWarnings</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SafeVarargs"><span class="toc-number">1.5.1.4.</span> <span class="toc-text">@SafeVarargs</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-%E5%87%BD%E6%95%B0%E5%BC%8F%E6%8E%A5%E5%8F%A3%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.5.2.</span> <span class="toc-text">5.2 函数式接口注解</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#FunctionalInterface-%E8%AF%A6%E7%BB%86%E8%A7%A3%E9%87%8A"><span class="toc-number">1.5.2.1.</span> <span class="toc-text">@FunctionalInterface 详细解释</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%87%BD%E6%95%B0%E5%BC%8F%E6%8E%A5%E5%8F%A3%EF%BC%9F"><span class="toc-number">1.5.2.1.1.</span> <span class="toc-text">什么是函数式接口？</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Lambda%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.5.2.1.2.</span> <span class="toc-text">Lambda表达式实现</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Lambda%E8%A1%A8%E8%BE%BE%E5%BC%8F%E8%AF%AD%E6%B3%95%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.5.2.1.3.</span> <span class="toc-text">Lambda表达式语法详解</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84%E5%87%BD%E6%95%B0%E5%BC%8F%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.5.2.1.4.</span> <span class="toc-text">常见的函数式接口</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.5.2.1.5.</span> <span class="toc-text">实际应用示例</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#FunctionalInterface%E6%B3%A8%E8%A7%A3%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-number">1.5.2.1.6.</span> <span class="toc-text">@FunctionalInterface注解的作用</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%8E%E4%BC%A0%E7%BB%9F%E6%8E%A5%E5%8F%A3%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">1.5.2.1.7.</span> <span class="toc-text">与传统接口的区别</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E5%BC%95%E7%94%A8%EF%BC%88Method-Reference%EF%BC%89"><span class="toc-number">1.5.2.1.8.</span> <span class="toc-text">方法引用（Method Reference）</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E6%A1%86%E6%9E%B6%E4%B8%AD%E7%9A%84%E5%B8%B8%E7%94%A8%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.6.</span> <span class="toc-text">6. 框架中的常用注解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFSpring%E6%A1%86%E6%9E%B6%EF%BC%9F"><span class="toc-number">1.6.1.</span> <span class="toc-text">什么是Spring框架？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-Spring%E6%A0%B8%E5%BF%83%E6%B3%A8%E8%A7%A3%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.6.2.</span> <span class="toc-text">6.1 Spring核心注解详解</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6%E6%B3%A8%E8%A7%A3%E7%B3%BB%E5%88%97"><span class="toc-number">1.6.2.1.</span> <span class="toc-text">组件注解系列</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Component-%E9%80%9A%E7%94%A8%E7%BB%84%E4%BB%B6%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.6.2.1.1.</span> <span class="toc-text">@Component - 通用组件注解</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Service-%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E5%B1%82%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.6.2.1.2.</span> <span class="toc-text">@Service - 业务逻辑层注解</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Repository-%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE%E5%B1%82%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.6.2.1.3.</span> <span class="toc-text">@Repository - 数据访问层注解</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Controller-Web%E6%8E%A7%E5%88%B6%E5%99%A8%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.6.2.1.4.</span> <span class="toc-text">@Controller - Web控制器注解</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.6.2.2.</span> <span class="toc-text">依赖注入注解</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Autowired-%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.6.2.2.1.</span> <span class="toc-text">@Autowired - 自动装配注解</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Qualifier-%E6%8C%87%E5%AE%9A%E5%85%B7%E4%BD%93Bean"><span class="toc-number">1.6.2.2.2.</span> <span class="toc-text">@Qualifier - 指定具体Bean</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Value-%E5%B1%9E%E6%80%A7%E5%80%BC%E6%B3%A8%E5%85%A5"><span class="toc-number">1.6.2.2.3.</span> <span class="toc-text">@Value - 属性值注入</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-Spring-Boot%E6%B3%A8%E8%A7%A3%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.6.3.</span> <span class="toc-text">6.2 Spring Boot注解详解</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#SpringBootApplication-%E5%90%AF%E5%8A%A8%E7%B1%BB%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.6.3.0.1.</span> <span class="toc-text">@SpringBootApplication - 启动类注解</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#REST-API%E6%B3%A8%E8%A7%A3%E7%B3%BB%E5%88%97"><span class="toc-number">1.6.3.0.2.</span> <span class="toc-text">REST API注解系列</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#RestController-REST%E6%8E%A7%E5%88%B6%E5%99%A8%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.6.3.0.3.</span> <span class="toc-text">@RestController - REST控制器注解</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#HTTP%E6%96%B9%E6%B3%95%E6%98%A0%E5%B0%84%E6%B3%A8%E8%A7%A3%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.6.3.0.4.</span> <span class="toc-text">HTTP方法映射注解详解</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E7%BB%91%E5%AE%9A%E6%B3%A8%E8%A7%A3%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.6.3.0.5.</span> <span class="toc-text">参数绑定注解详解</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#REST-API%E5%AE%8C%E6%95%B4%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.6.3.1.</span> <span class="toc-text">REST API完整示例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-JPA-Hibernate%E6%B3%A8%E8%A7%A3%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.6.4.</span> <span class="toc-text">6.3 JPA&#x2F;Hibernate注解详解</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E5%AE%9E%E4%BD%93%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.6.4.1.</span> <span class="toc-text">核心实体注解</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Entity-%E5%AE%9E%E4%BD%93%E7%B1%BB%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.6.4.1.1.</span> <span class="toc-text">@Entity - 实体类注解</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Table-%E8%A1%A8%E6%98%A0%E5%B0%84%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.6.4.1.2.</span> <span class="toc-text">@Table - 表映射注解</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Id-%E5%92%8C%E4%B8%BB%E9%94%AE%E7%94%9F%E6%88%90%E7%AD%96%E7%95%A5"><span class="toc-number">1.6.4.1.3.</span> <span class="toc-text">@Id 和主键生成策略</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Column-%E5%AD%97%E6%AE%B5%E6%98%A0%E5%B0%84%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.6.4.1.4.</span> <span class="toc-text">@Column - 字段映射注解</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B3%E8%81%94%E5%85%B3%E7%B3%BB%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.6.4.2.</span> <span class="toc-text">关联关系注解</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#OneToOne-%E4%B8%80%E5%AF%B9%E4%B8%80%E5%85%B3%E7%B3%BB"><span class="toc-number">1.6.4.2.1.</span> <span class="toc-text">@OneToOne - 一对一关系</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#OneToMany-%E4%B8%80%E5%AF%B9%E5%A4%9A%E5%85%B3%E7%B3%BB"><span class="toc-number">1.6.4.2.2.</span> <span class="toc-text">@OneToMany - 一对多关系</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ManyToMany-%E5%A4%9A%E5%AF%B9%E5%A4%9A%E5%85%B3%E7%B3%BB"><span class="toc-number">1.6.4.2.3.</span> <span class="toc-text">@ManyToMany - 多对多关系</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BA%A7%E8%81%94%E6%93%8D%E4%BD%9C%E5%92%8C%E8%8E%B7%E5%8F%96%E7%AD%96%E7%95%A5"><span class="toc-number">1.6.4.3.</span> <span class="toc-text">级联操作和获取策略</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BA%A7%E8%81%94%E6%93%8D%E4%BD%9C%EF%BC%88Cascade%EF%BC%89"><span class="toc-number">1.6.4.3.1.</span> <span class="toc-text">级联操作（Cascade）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%AD%96%E7%95%A5%EF%BC%88Fetch%EF%BC%89"><span class="toc-number">1.6.4.3.2.</span> <span class="toc-text">获取策略（Fetch）</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%8C%E6%95%B4%E7%9A%84JPA%E5%AE%9E%E4%BD%93%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.6.4.4.</span> <span class="toc-text">完整的JPA实体示例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-Bean-Validation%EF%BC%88%E6%95%B0%E6%8D%AE%E9%AA%8C%E8%AF%81%EF%BC%89%E6%B3%A8%E8%A7%A3%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.6.5.</span> <span class="toc-text">6.4 Bean Validation（数据验证）注解详解</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E9%AA%8C%E8%AF%81%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.6.5.1.</span> <span class="toc-text">基础验证注解</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A9%BA%E5%80%BC%E6%A3%80%E6%9F%A5%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.6.5.1.1.</span> <span class="toc-text">空值检查注解</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%95%B0%E5%80%BC%E8%8C%83%E5%9B%B4%E9%AA%8C%E8%AF%81%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.6.5.1.2.</span> <span class="toc-text">数值范围验证注解</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%A0%BC%E5%BC%8F%E9%AA%8C%E8%AF%81%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.6.5.1.3.</span> <span class="toc-text">字符串格式验证注解</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E6%97%A5%E6%9C%9F%E9%AA%8C%E8%AF%81%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.6.5.1.4.</span> <span class="toc-text">时间日期验证注解</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%AB%98%E7%BA%A7%E9%AA%8C%E8%AF%81%E5%8A%9F%E8%83%BD"><span class="toc-number">1.6.5.2.</span> <span class="toc-text">高级验证功能</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E9%AA%8C%E8%AF%81%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.6.5.2.1.</span> <span class="toc-text">自定义验证注解</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%B1%BB%E7%BA%A7%E5%88%AB%E9%AA%8C%E8%AF%81%EF%BC%88%E8%B7%A8%E5%AD%97%E6%AE%B5%E9%AA%8C%E8%AF%81%EF%BC%89"><span class="toc-number">1.6.5.2.2.</span> <span class="toc-text">类级别验证（跨字段验证）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81%E7%BB%84%EF%BC%88Validation-Groups%EF%BC%89"><span class="toc-number">1.6.5.2.3.</span> <span class="toc-text">验证组（Validation Groups）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="toc-number">1.6.5.2.4.</span> <span class="toc-text">全局异常处理</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-5-%E6%B5%8B%E8%AF%95%E6%B3%A8%E8%A7%A3%E8%AF%A6%E8%A7%A3%EF%BC%88JUnit-5-Spring-Boot-Test%EF%BC%89"><span class="toc-number">1.6.6.</span> <span class="toc-text">6.5 测试注解详解（JUnit 5 + Spring Boot Test）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#JUnit-5-%E6%A0%B8%E5%BF%83%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.6.6.1.</span> <span class="toc-text">JUnit 5 核心注解</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E6%B5%8B%E8%AF%95%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.6.6.1.1.</span> <span class="toc-text">基础测试注解</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E5%8C%96%E6%B5%8B%E8%AF%95%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.6.6.1.2.</span> <span class="toc-text">参数化测试注解</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Spring-Boot-%E6%B5%8B%E8%AF%95%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.6.6.2.</span> <span class="toc-text">Spring Boot 测试注解</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%8C%E6%95%B4%E5%BA%94%E7%94%A8%E4%B8%8A%E4%B8%8B%E6%96%87%E6%B5%8B%E8%AF%95"><span class="toc-number">1.6.6.2.1.</span> <span class="toc-text">完整应用上下文测试</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Web%E5%B1%82%E6%B5%8B%E8%AF%95"><span class="toc-number">1.6.6.2.2.</span> <span class="toc-text">Web层测试</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%B1%82%E6%B5%8B%E8%AF%95"><span class="toc-number">1.6.6.2.3.</span> <span class="toc-text">数据层测试</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%B1%82%E6%B5%8B%E8%AF%95%EF%BC%88%E4%BD%BF%E7%94%A8Mock%EF%BC%89"><span class="toc-number">1.6.6.2.4.</span> <span class="toc-text">服务层测试（使用Mock）</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.7.</span> <span class="toc-text">7. 自定义注解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-%E5%88%9B%E5%BB%BA%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.7.1.</span> <span class="toc-text">7.1 创建自定义注解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-%E6%B3%A8%E8%A7%A3%E5%A4%84%E7%90%86%E5%99%A8%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.7.2.</span> <span class="toc-text">7.2 注解处理器实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-%E9%80%9A%E8%BF%87%E5%8F%8D%E5%B0%84%E5%A4%84%E7%90%86%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.7.3.</span> <span class="toc-text">7.3 通过反射处理注解</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-%E6%B3%A8%E8%A7%A3%E7%9A%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="toc-number">1.8.</span> <span class="toc-text">8. 注解的最佳实践</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99"><span class="toc-number">1.8.1.</span> <span class="toc-text">8.1 设计原则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-%E4%BD%BF%E7%94%A8%E5%BB%BA%E8%AE%AE"><span class="toc-number">1.8.2.</span> <span class="toc-text">8.2 使用建议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-%E6%80%A7%E8%83%BD%E8%80%83%E8%99%91"><span class="toc-number">1.8.3.</span> <span class="toc-text">8.3 性能考虑</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-%E5%B8%B8%E8%A7%81%E9%94%99%E8%AF%AF%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-number">1.9.</span> <span class="toc-text">9. 常见错误和解决方案</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#9-1-%E6%B3%A8%E8%A7%A3%E4%B8%A2%E5%A4%B1%E9%97%AE%E9%A2%98"><span class="toc-number">1.9.1.</span> <span class="toc-text">9.1 注解丢失问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-2-%E7%BB%A7%E6%89%BF%E9%97%AE%E9%A2%98"><span class="toc-number">1.9.2.</span> <span class="toc-text">9.2 继承问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-3-%E9%87%8D%E5%A4%8D%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.9.3.</span> <span class="toc-text">9.3 重复注解</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-%E5%AD%A6%E4%B9%A0%E5%BB%BA%E8%AE%AE"><span class="toc-number">1.10.</span> <span class="toc-text">10. 学习建议</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#10-1-%E5%BE%AA%E5%BA%8F%E6%B8%90%E8%BF%9B"><span class="toc-number">1.10.1.</span> <span class="toc-text">10.1 循序渐进</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-2-%E5%AE%9E%E8%B7%B5%E9%A1%B9%E7%9B%AE"><span class="toc-number">1.10.2.</span> <span class="toc-text">10.2 实践项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-3-%E8%BF%9B%E9%98%B6%E5%AD%A6%E4%B9%A0"><span class="toc-number">1.10.3.</span> <span class="toc-text">10.3 进阶学习</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">1.11.</span> <span class="toc-text">总结</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/08/15/%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E4%B8%8E%E7%BD%91%E7%AB%99%E7%BB%91%E5%AE%9A%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97/" title="域名解析与网站绑定完全指南">域名解析与网站绑定完全指南</a><time datetime="2025-08-15T03:00:00.000Z" title="Created 2025-08-15 11:00:00">2025-08-15</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/08/13/React-vs-Vue-%E6%B7%B1%E5%BA%A6%E5%AF%B9%E5%86%B3/" title="React vs. Vue：前端框架的深度对决">React vs. Vue：前端框架的深度对决</a><time datetime="2025-08-13T08:45:00.000Z" title="Created 2025-08-13 16:45:00">2025-08-13</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/08/13/%E7%BD%91%E9%A1%B5%E6%9E%84%E5%BB%BA%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E8%AF%A6%E8%A7%A3/" title="🌐 网页构建基础知识详解">🌐 网页构建基础知识详解</a><time datetime="2025-08-12T16:00:00.000Z" title="Created 2025-08-13 00:00:00">2025-08-13</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/08/12/Java%20%E6%B3%A8%E8%A7%A3/" title="Java 注解">Java 注解</a><time datetime="2025-08-12T08:18:13.000Z" title="Created 2025-08-12 16:18:13">2025-08-12</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/08/12/%E4%BA%91%E5%8E%9F%E7%94%9F%E7%BB%93%E8%AF%BEproject/" title="云原生结课project">云原生结课project</a><time datetime="2025-08-12T07:52:32.000Z" title="Created 2025-08-12 15:52:32">2025-08-12</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 By forever</span><span class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.4.3</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="Scroll to Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const getGiscusTheme = theme => theme === 'dark' ? 'dark' : 'light'

  const createScriptElement = config => {
    const ele = document.createElement('script')
    Object.entries(config).forEach(([key, value]) => {
      ele.setAttribute(key, value)
    })
    return ele
  }

  const loadGiscus = (el = document, key) => {
    const mappingConfig = isShuoshuo
      ? { 'data-mapping': 'specific', 'data-term': key }
      : { 'data-mapping': (option && option['data-mapping']) || 'pathname' }

    const giscusConfig = {
      src: 'https://giscus.app/client.js',
      'data-repo': '231220075/231220075.github.io',
      'data-repo-id': 'R_kgDOOA3Tzw',
      'data-category-id': 'DIC_kwDOOA3Tz84Ct7NB',
      'data-theme': getGiscusTheme(document.documentElement.getAttribute('data-theme')),
      'data-reactions-enabled': '1',
      crossorigin: 'anonymous',
      async: true,
      ...option,
      ...mappingConfig
    }

    const scriptElement = createScriptElement(giscusConfig)

    el.querySelector('#giscus-wrap').appendChild(scriptElement)

    if (isShuoshuo) {
      window.shuoshuoComment.destroyGiscus = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }
  }

  const changeGiscusTheme = theme => {
    const iframe = document.querySelector('#giscus-wrap iframe')
    if (iframe) {
      const message = {
        giscus: {
          setConfig: {
            theme: getGiscusTheme(theme)
          }
        }
      }
      iframe.contentWindow.postMessage(message, 'https://giscus.app')
    }
  }

  btf.addGlobalFn('themeChange', changeGiscusTheme, 'giscus')

  if (isShuoshuo) {
    'Giscus' === 'Giscus'
      ? window.shuoshuoComment = { loadComment: loadGiscus }
      : window.loadOtherComment = loadGiscus
    return
  }

  if ('Giscus' === 'Giscus' || !false) {
    if (false) btf.loadComment(document.getElementById('giscus-wrap'), loadGiscus)
    else loadGiscus()
  } else {
    window.loadOtherComment = loadGiscus
  }
})()</script></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="30" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search..." type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>